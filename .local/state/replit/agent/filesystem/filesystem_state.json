{"file_contents":{"replit.md":{"content":"# –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏\n\n## Overview\nThis desktop application, built with Streamlit, analyzes Microsoft Project plan files. It parses MS Project XML files to identify workload imbalances among resources, visualizes allocation patterns with color-coded status indicators, and provides actionable recommendations for optimization. Users can filter resources, view detailed task breakdowns, and export analysis results in CSV or PDF format. The project aims to provide a quick prototyping interface focused on data analysis without complex frontend development, offering a Python-native approach to building interactive web applications for data visualization.\n\n## Recent Changes (November 1, 2025)\n\n**Latest Fix (.exe Build - PackageNotFoundError & Compilation Errors - November 1, 2025):**\n- **Problem Solved**: Fixed critical `importlib.metadata.PackageNotFoundError` when running MSProjectAnalyzer.exe\n- **Root Cause**: PyInstaller wasn't including package metadata (version info) that Streamlit checks at runtime\n- **Solution Implemented**:\n  - Updated `app.spec`: Added `copy_metadata()` calls for all libraries (streamlit, pandas, plotly, altair, lxml, reportlab, openpyxl, python-dateutil, pyarrow, click, validators, watchdog, tornado)\n  - Updated `build_exe.bat`: \n    - Added `--only-binary :all:` for pandas and pyarrow installation (prevents Windows compilation errors)\n    - Separated dependency installation: first pip/wheel/setuptools upgrade, then pandas/pyarrow binaries, then remaining packages\n    - Added clear error messages and 64-bit Python verification hints\n  - Updated `BUILD_INSTRUCTIONS.md`: Added troubleshooting sections for:\n    - PackageNotFoundError with clear explanation and rebuild steps\n    - Windows compilation errors (pandas/pyarrow) with --only-binary solutions\n    - 64-bit Python verification and Microsoft C++ Build Tools guidance\n- **Testing**: Architect-reviewed, user successfully built .exe after fixes\n- **Files Modified**: app.spec (copy_metadata), build_exe.bat (--only-binary installation), BUILD_INSTRUCTIONS.md (troubleshooting)\n\n**Previous Enhancement (Display Mode Switcher - October 31, 2025):**\n- **Display Mode Toggle**: Added switchable display mode for workload visualization with two options:\n  - **–í –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö (Percentage mode)**: Default mode showing workload as percentage of capacity\n    - Analysis table column: \"–ù–∞–≥—Ä—É–∑–∫–∞ %\" with values like \"85.5%\"\n    - Chart Y-axis: \"–ü—Ä–æ—Ü–µ–Ω—Ç –Ω–∞–≥—Ä—É–∑–∫–∏ (%)\"\n    - Threshold lines: 100% (overloaded) and 70% (underutilized)\n  - **–í —á–∞—Å–∞—Ö (Hours mode)**: Shows workload in absolute hours\n    - Analysis table column: \"–ó–∞–≥—Ä—É–∑–∫–∞ (—á–∞—Å—ã)\" with values like \"68.4 —á.\"\n    - Chart Y-axis: \"–ó–∞–≥—Ä—É–∑–∫–∞ (—á–∞—Å—ã)\"\n    - Threshold lines: calculated based on average capacity per resource\n- **Implementation Details**:\n  - Radio button control in sidebar: \"–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏\"\n  - Mode stored in `st.session_state.display_mode` ('percentage' or 'hours')\n  - Triggers automatic page reload (st.rerun) with full state persistence\n  - Affects all visualization components: analysis table, workload distribution chart, weekly timeline chart\n- **Export Support**: CSV and PDF export functions updated to handle both display modes\n  - Status determination based on percentage calculation regardless of display mode\n  - Column headers and values adapt to selected mode\n- **Testing**: E2E verified both modes work correctly with seamless switching across all components\n\n**Previous Enhancements (Resource Groups, Period Analytics & Actual Hours):**\n- **Resource Groups Management**: Added complete workflow for managing custom resource groups:\n  - Create groups with custom names and selected resources\n  - Save groups in session state (persist during session)\n  - Apply groups via explicit button with UI refresh (st.rerun)\n  - Delete groups with automatic cleanup of applied state\n  - Expander-based UI for group creation and management\n- **Period Analysis Panel**: Added control panel displaying:\n  - Selected date range (formatted as DD.MM.YYYY - DD.MM.YYYY)\n  - Business days count (excluding weekends: Saturday, Sunday)\n  - Work capacity per person (business_days √ó 8 hours)\n  - Implemented `calculate_business_days()` and `calculate_work_capacity()` helper functions\n- **Actual Working Hours**: New column \"–†–∞–±–æ—á–∏–µ —á–∞—Å—ã –∑–∞ –ø–µ—Ä–∏–æ–¥\" in analysis table:\n  - Calculates actual hours for each resource within selected date range\n  - Uses proportional allocation for tasks spanning multiple periods\n  - Implemented `calculate_actual_hours_per_resource()` function\n- **Enhanced CSV/PDF Export**: Exports now include:\n  - Period information header (dates, business days, capacity)\n  - New \"–†–∞–±–æ—á–∏–µ —á–∞—Å—ã –∑–∞ –ø–µ—Ä–∏–æ–¥\" / \"–ß–∞—Å—ã –∑–∞ –ø–µ—Ä–∏–æ–¥\" column in resource tables\n  - Updated export function signatures with period parameters\n- **Bug Fixes**: \n  - Fixed `KeyError: 'start_date'` in `calculate_actual_hours_per_resource`: now uses task.get('start')/task.get('finish') and parser.assignments\n  - Fixed group application flow: added \"–ü—Ä–∏–º–µ–Ω–∏—Ç—å –≥—Ä—É–ø–ø—É\" button with proper st.rerun() behavior\n\n**Previous Enhancements (Smart Default Dates & Resource Filtering):**\n- **Default Date Range Logic**: Changed initialization from full project range to current week context:\n  - Start: current date - 7 days, rounded to Monday (weekday=0)\n  - End: current date + 14 days, rounded to Friday (weekday=4)\n  - Dates are clamped within project bounds to prevent `StreamlitAPIException`\n  - Provides focused 3-week analysis window by default\n- **Resource Filter Applied Globally**: selected_resources filter now affects ALL UI sections:\n  - Task details section (uses filtered display_data)\n  - Recommendations (filtered_analysis created with resource filtering)\n  - Workload distribution chart (uses filtered display_data)\n  - Optimization suggestions (selected_resources passed to optimize_with_task_shifting)\n  - Weekly timeline visualization (timeline_data filtered by keys)\n  - Interactive specialist replacement (uses filtered_analysis)\n- **Bug Fix**: Fixed date clamp logic to prevent defaults outside project_start...project_end bounds\n\n**Previous Bug Fixes (Export Functionality):**\n- Fixed `UnicodeEncodeError` in CSV export: Added `remove_emojis()` function to strip emoji symbols (üî¥, üü¢) before cp1251 encoding, ensuring Excel compatibility\n- Fixed `KeyError: 'task'` in export functions: Updated CSV/PDF exporters to use correct optimization_results structure (`task_name`, `shift_days`, `improvement`, `reason`, `priority` instead of deprecated `task`, `action`, `details`)\n- Enhanced export data completeness: CSV/PDF now include 4 sections (summary, task details, weekly timeline, optimization suggestions) with proper field mapping\n\n**Previous Critical Bug Fixes:**\n- Fixed `AttributeError: 'Figure' object has no attribute 'update_xaxis'` - replaced with correct Plotly methods: `update_xaxes()` and `update_yaxes()`\n- Optimized task shifting algorithm: weeks_with_dates construction moved to resource level (instead of repeating for each task)\n- Improved target week determination logic: now finds ALL overlapping weeks, selects the main one with the largest task proportion\n- Added real hours calculation instead of percentages only: hours_removed_from_source and hours_added_to_target\n- Fixed date range filtering bug: `weeks_with_dates` in `optimize_with_task_shifting` now constructed from filtered `date_range` for consistency with timeline_data\n\n**End-to-End Testing:**\n- All core features working correctly\n- Verified: file upload, smart default dates, resource filtering across all sections (task details, recommendations, charts, optimization, timeline, interactive replacement)\n- Previous verifications: analysis, optimization, visualization, CSV/PDF export with emoji sanitization and correct optimization schema\n\n## User Preferences\n–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π —Å—Ç–∏–ª—å –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏: –ü—Ä–æ—Å—Ç–æ–π, –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã–π —è–∑—ã–∫ –Ω–∞ —Ä—É—Å—Å–∫–æ–º.\n\n## System Architecture\n\n### UI/UX Decisions\nThe application uses Streamlit for rapid prototyping and interactive data visualization. Plotly is utilized for interactive, professional-grade charts, enabling rich interactivity like hovering, zooming, and panning. \n\n**Design System**: The application uses Material Design 3 (MD3) as its single design system:\n- **Material Design 3**: Google's MD3 design system with elevated cards, rounded corners, modern typography, and a purple-blue color palette generated from seed color #0078D4\n  - Colors: Primary #005EB0, Error #BA1A1A, Tertiary #6D5677, Surface #FEF7FF\n  - Modular components defined in `md3_components.py`\n  - Elevated metric cards, alternating row styles, and hover effects\n  - Red/Yellow/Green color-coding system for workload status (overloaded/underutilized/optimal)\n\n**Display Modes**: Users can switch between two display modes for workload visualization:\n- **–í –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö (Percentage)**: Shows workload as percentage of capacity (default)\n- **–í —á–∞—Å–∞—Ö (Hours)**: Shows workload in absolute hours\n- Mode selection stored in `st.session_state.display_mode` and triggers automatic page reload with full state preservation\n\n### Technical Implementations\nThe backend processes MS Project XML files using `lxml` for robust parsing, handling large files efficiently. Data manipulation and complex resource allocation calculations are performed using Pandas DataFrames.\n\n### Feature Specifications\n- **Workload Calculation Logic**: Resources are categorized as Overloaded (>100% capacity - Red), Optimal (70-100% capacity - Green), or Underutilized (<70% capacity - Yellow) based on actual project timelines versus resource capacity.\n- **Recommendation Engine**: Provides actionable suggestions for rebalancing workloads, prioritizing resources based on their overload percentage (High: >120%, Medium: 100-120%, Low: optimizing underutilized resources).\n- **Intelligent Optimization**:\n    - Calculates weekly resource loading, identifies peaks and troughs, and caches tasks for performance.\n    - Implements a task shifting algorithm to automatically suggest optimal task shifts (1-30 days) for overloaded weeks, considering multi-week tasks and ensuring the target week does not become overloaded.\n    - Offers interactive specialist replacement, allowing users to substitute overloaded resources with underutilized ones.\n    - Visualizes weekly loading with Plotly bar charts, showing 100% and target loading lines, and color-coded weeks (red for overloaded, green for optimal, yellow for underutilized).\n- **Report Generation**: Exports professional PDF reports using ReportLab with custom styling and CSV exports via Pandas for raw data analysis.\n- **State Management**: Utilizes `st.session_state` to preserve parsed data, user selections, and analysis results across interactions.\n\n### System Design Choices\nThe application is designed to be highly interactive and data-driven, leveraging Python's strengths in data processing and web application development. The choice of Streamlit and Plotly reflects a priority for quick development and rich interactive visualization.\n\n## External Dependencies\n\n### Core Libraries\n- **Streamlit**: Web framework for interactive applications.\n- **Pandas**: For tabular data manipulation and analysis.\n- **lxml**: High-performance XML parser, specifically for Microsoft Project XML files.\n- **Plotly**: For interactive charting and data visualization.\n- **ReportLab**: For generating PDF documents.\n\n### File Format Support\n- **Microsoft Project XML**: Supports `.xml` and `.mspdi` file formats. `.mpp` files must be converted to XML from MS Project.","size_bytes":11809},"README.md":{"content":"# –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏\n\n–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –Ω–∞—Å—Ç–æ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ñ–∞–π–ª–æ–≤ –ø–ª–∞–Ω–æ–≤ Microsoft Project —Å —Ü–µ–ª—å—é –≤—ã—è–≤–ª–µ–Ω–∏—è –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ —Ä–∞–±–æ—á–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.\n\n## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏\n\n- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∞–π–ª–æ–≤ MS Project**: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–∞—Ä—Å–∏–Ω–≥ XML-—Ñ–∞–π–ª–æ–≤ Microsoft Project (.xml, .mspdi)\n- **–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç —Ä–∞–±–æ—á–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏**: –ê–Ω–∞–ª–∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ä–æ–∫–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –º–æ—â–Ω–æ—Å—Ç–∏ —Ä–µ—Å—É—Ä—Å–æ–≤\n- **–ü–æ–∏—Å–∫ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞**: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫ –∑–∞–¥–∞—á –ø–æ –∏–º–µ–Ω–∞–º –∏ —Ñ–∞–º–∏–ª–∏—è–º —Ä–µ—Å—É—Ä—Å–æ–≤\n- **–í–∏–∑—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑**: –¶–≤–µ—Ç–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å—Ç–∞—Ç—É—Å–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å —Ä–µ—Å—É—Ä—Å–∞–º–∏\n  - üî¥ –ö—Ä–∞—Å–Ω—ã–π: –ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω (>100% –º–æ—â–Ω–æ—Å—Ç–∏)\n  - üü¢ –ó–µ–ª—ë–Ω—ã–π: –û–ø—Ç–∏–º–∞–ª—å–Ω–æ (70-100% –º–æ—â–Ω–æ—Å—Ç–∏)\n  - üü° –ñ—ë–ª—Ç—ã–π: –ù–µ–¥–æ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (<70% –º–æ—â–Ω–æ—Å—Ç–∏)\n- **–£–º–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**: –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–µ —Ä–∞–±–æ—á–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏\n- **–í–∞—Ä–∏–∞–Ω—Ç—ã —ç–∫—Å–ø–æ—Ä—Ç–∞**: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ CSV –∏–ª–∏ PDF\n\n## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å\n\n### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–∞ MS Project\n\n–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —Ñ–∞–π–ª .mpp, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ –µ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç XML:\n1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç –≤ Microsoft Project\n2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–§–∞–π–ª ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫**\n3. –í—ã–±–µ—Ä–∏—Ç–µ **–§–æ—Ä–º–∞—Ç XML (*.xml)** –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞\n4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª\n\n### 2. –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑\n\n1. –ù–∞–∂–º–∏—Ç–µ \"–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª\" –Ω–∞ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏\n2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à XML-—Ñ–∞–π–ª MS Project\n3. –ù–∞–∂–º–∏—Ç–µ \"–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª\" –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö\n4. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–∞–Ω–µ–ª—å –∞–Ω–∞–ª–∏–∑–∞ —Ä–∞–±–æ—á–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏\n\n### 3. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫\n\n- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ —Ñ–∞–º–∏–ª–∏–∏\n- –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã —Å –ø–æ–º–æ—â—å—é –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞\n- –†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Ä–∞–∑–±–∏–≤–∫–∏ –∑–∞–¥–∞—á\n\n### 4. –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π\n\n–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:\n- **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –†–µ—Å—É—Ä—Å—ã —Å –Ω–∞–≥—Ä—É–∑–∫–æ–π –±–æ–ª–µ–µ 120%\n- **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –†–µ—Å—É—Ä—Å—ã —Å –Ω–∞–≥—Ä—É–∑–∫–æ–π 100-120%\n- **–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –Ω–µ–¥–æ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤\n\n### 5. –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤\n\n–°–∫–∞—á–∞–π—Ç–µ –≤–∞—à –∞–Ω–∞–ª–∏–∑ –≤ –≤–∏–¥–µ:\n- **CSV**: –î–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤ Excel –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö\n- **PDF**: –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π\n\n## –†–∞—Å—á—ë—Ç —Ä–∞–±–æ—á–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏\n\n–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç —Ä–∞–±–æ—á–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ:\n\n- **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∏–∑ –¥–∞—Ç –Ω–∞—á–∞–ª–∞/–æ–∫–æ–Ω—á–∞–Ω–∏—è –∑–∞–¥–∞—á\n- **–ú–æ—â–Ω–æ—Å—Ç–∏ —Ä–µ—Å—É—Ä—Å–∞**: –ù–∞ –æ—Å–Ω–æ–≤–µ MaxUnits –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π 40-—á–∞—Å–æ–≤–æ–π —Ä–∞–±–æ—á–µ–π –Ω–µ–¥–µ–ª–∏ (5 –¥–Ω–µ–π √ó 8 —á–∞—Å–æ–≤)\n- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–π –∑–∞–¥–∞—á**: –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤, –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö –∫–∞–∂–¥–æ–º—É —Ä–µ—Å—É—Ä—Å—É\n\n**–ú–æ–¥–µ–ª—å –º–æ—â–Ω–æ—Å—Ç–∏**:\n- –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–µ –¥–Ω–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è 5/7 (5-–¥–Ω–µ–≤–Ω–∞—è —Ä–∞–±–æ—á–∞—è –Ω–µ–¥–µ–ª—è)\n- –ö–∞–∂–¥—ã–π —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç 8 —á–∞—Å–æ–≤ —Ä–∞–±–æ—á–µ–π –º–æ—â–Ω–æ—Å—Ç–∏ (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç P1D = 8 —á–∞—Å–æ–≤ –≤ MS Project)\n- –ú–æ—â–Ω–æ—Å—Ç—å —Ä–µ—Å—É—Ä—Å–∞ = –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã √ó MaxUnits\n\n**–§–æ—Ä–º—É–ª–∞**: `–ù–∞–≥—Ä—É–∑–∫–∞ % = (–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö —á–∞—Å–æ–≤ / –ú–æ—â–Ω–æ—Å—Ç—å) √ó 100`\n\n**–ü—Ä–∏–º–µ—Ä—ã** (–¥–ª—è MaxUnits = 1.0):\n- 1 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –¥–µ–Ω—å ‚Üí 0.71 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π ‚Üí 5.71 —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤ –º–æ—â–Ω–æ—Å—Ç–∏\n- 7 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π ‚Üí 5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π ‚Üí 40 —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤ –º–æ—â–Ω–æ—Å—Ç–∏\n- 28 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π ‚Üí 20 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π ‚Üí 160 —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤ –º–æ—â–Ω–æ—Å—Ç–∏\n\n## –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞\n\n–í —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º –ø–æ –¥–∏–∑–∞–π–Ω—É Microsoft Project:\n- –û—Å–Ω–æ–≤–Ω–æ–π —Å–∏–Ω–∏–π: #0078D4\n- –ó–µ–ª—ë–Ω—ã–π —É—Å–ø–µ—Ö–∞: #107C10\n- –ö—Ä–∞—Å–Ω—ã–π –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è: #FF4B4B\n- –°–µ—Ä—ã–π —Ñ–æ–Ω–∞: #F3F2F1\n- –£–≥–æ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç: #323130\n\n## –û–±—Ä–∞–∑–µ—Ü –¥–∞–Ω–Ω—ã—Ö\n\n–û–±—Ä–∞–∑–µ—Ü —Ñ–∞–π–ª–∞ –ø—Ä–æ–µ–∫—Ç–∞ (`sample_project.xml`) –≤–∫–ª—é—á—ë–Ω –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –û–Ω –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç:\n- 5 —Ä–µ—Å—É—Ä—Å–æ–≤ —Å —Ä–∞–∑–ª–∏—á–Ω–æ–π —Ä–∞–±–æ—á–µ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π\n- 8 –∑–∞–¥–∞—á —Å —Ä–∞–∑–Ω–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é\n- –ù–∞–∑–Ω–∞—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –∏ –Ω–µ–¥–æ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è\n\n## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏\n\n- –ü–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ Streamlit –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞\n- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç lxml –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ XML\n- Plotly –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π\n- ReportLab –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF\n- Pandas –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö\n\n## –ü–æ–¥–¥–µ—Ä–∂–∫–∞\n\n–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å:\n- **–ü–∞—Ä—Å–∏–Ω–≥–æ–º —Ñ–∞–π–ª–æ–≤**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à XML-—Ñ–∞–π–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ —ç–∫—Å–ø–æ—Ä—Ç MS Project\n- **–†–∞—Å—á—ë—Ç–∞–º–∏ –¥–∞—Ç**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∑–∞–¥–∞—á–∏ –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è\n- **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ä–µ—Å—É—Ä—Å—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ\n","size_bytes":6940},"app.py":{"content":"import streamlit as st\nimport pandas as pd\nimport plotly.graph_objects as go\nfrom datetime import datetime, timedelta\nimport io\nfrom lxml import etree\nfrom reportlab.lib import colors\nfrom reportlab.lib.pagesizes import letter, A4\nfrom reportlab.platypus import SimpleDocTemplate, Table, TableStyle, Paragraph, Spacer\nfrom reportlab.lib.styles import getSampleStyleSheet, ParagraphStyle\nfrom reportlab.lib.units import inch\nfrom reportlab.pdfbase import pdfmetrics\nfrom reportlab.pdfbase.ttfonts import TTFont\n\n# –ò–º–ø–æ—Ä—Ç MD3 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤\nfrom md3_components import get_md3_css, md3_info_panel, get_md3_table_style, get_md3_chart_colors\n\n# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã\nst.set_page_config(\n    page_title=\"–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏\",\n    page_icon=\"üìä\",\n    layout=\"wide\",\n    initial_sidebar_state=\"expanded\"\n)\n\n# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ MD3 –¥–∏–∑–∞–π–Ω–∞\nst.markdown(get_md3_css(), unsafe_allow_html=True)\n\n# MS Project XML Parser\nclass MSProjectParser:\n    \"\"\"–ü–∞—Ä—Å–µ—Ä –¥–ª—è XML-—Ñ–∞–π–ª–æ–≤ MS Project (.xml, .mspdi)\"\"\"\n    \n    def __init__(self, file_content):\n        self.file_content = file_content\n        self.tasks = []\n        self.resources = []\n        self.assignments = []\n    \n    @staticmethod\n    def clean_xml_content(xml_bytes):\n        \"\"\"\n        –£–¥–∞–ª—è–µ—Ç –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã –∏–∑ XML-–∫–æ–Ω—Ç–µ–Ω—Ç–∞.\n        XML 1.0 –¥–æ–ø—É—Å–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã:\n        - 0x09 (tab), 0x0A (LF), 0x0D (CR)\n        - 0x20-0xD7FF, 0xE000-0xFFFD, 0x10000-0x10FFFF\n        \"\"\"\n        # –î–µ–∫–æ–¥–∏—Ä—É–µ–º –≤ —Å—Ç—Ä–æ–∫—É\n        try:\n            xml_str = xml_bytes.decode('utf-8')\n        except:\n            xml_str = xml_bytes.decode('utf-8', errors='ignore')\n        \n        # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–ø—É—Å—Ç–∏–º–æ—Å—Ç–∏ —Å–∏–º–≤–æ–ª–∞\n        def is_valid_xml_char(c):\n            codepoint = ord(c)\n            return (\n                codepoint == 0x09 or\n                codepoint == 0x0A or\n                codepoint == 0x0D or\n                (0x20 <= codepoint <= 0xD7FF) or\n                (0xE000 <= codepoint <= 0xFFFD) or\n                (0x10000 <= codepoint <= 0x10FFFF)\n            )\n        \n        # –§–∏–ª—å—Ç—Ä—É–µ–º –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã\n        cleaned_str = ''.join(c for c in xml_str if is_valid_xml_char(c))\n        \n        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ –±–∞–π—Ç—ã\n        return cleaned_str.encode('utf-8')\n        \n    def parse(self):\n        \"\"\"–ü–∞—Ä—Å–∏–Ω–≥ XML-—Ñ–∞–π–ª–∞ MS Project\"\"\"\n        try:\n            # –û—á–∏—â–∞–µ–º XML –æ—Ç –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤\n            cleaned_content = self.clean_xml_content(self.file_content)\n            \n            tree = etree.parse(io.BytesIO(cleaned_content))\n            root = tree.getroot()\n            \n            # –ü–æ–ª—É—á–µ–Ω–∏–µ namespace\n            namespace = {'ns': root.nsmap[None]} if None in root.nsmap else {}\n            \n            # –ü–∞—Ä—Å–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤\n            self.resources = self._parse_resources(root, namespace)\n            \n            # –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–¥–∞—á\n            self.tasks = self._parse_tasks(root, namespace)\n            \n            # –ü–∞—Ä—Å–∏–Ω–≥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π\n            self.assignments = self._parse_assignments(root, namespace)\n            \n            return True\n        except Exception as e:\n            st.error(f\"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ —Ñ–∞–π–ª–∞ MS Project: {str(e)}\")\n            return False\n    \n    def _parse_resources(self, root, namespace):\n        \"\"\"–ü–∞—Ä—Å–∏–Ω–≥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ—Å—É—Ä—Å–∞—Ö\"\"\"\n        resources = []\n        resource_elements = root.findall('.//ns:Resource', namespace) if namespace else root.findall('.//Resource')\n        \n        for resource in resource_elements:\n            resource_id = self._get_text(resource, 'ns:UID' if namespace else 'UID', namespace)\n            name = self._get_text(resource, 'ns:Name' if namespace else 'Name', namespace)\n            \n            if resource_id and name:\n                resources.append({\n                    'id': resource_id,\n                    'name': name,\n                    'max_units': self._get_text(resource, 'ns:MaxUnits' if namespace else 'MaxUnits', namespace, default='1.0')\n                })\n        \n        return resources\n    \n    def _parse_tasks(self, root, namespace):\n        \"\"\"Parse task information\"\"\"\n        tasks = []\n        task_elements = root.findall('.//ns:Task', namespace) if namespace else root.findall('.//Task')\n        \n        for task in task_elements:\n            task_id = self._get_text(task, 'ns:UID' if namespace else 'UID', namespace)\n            name = self._get_text(task, 'ns:Name' if namespace else 'Name', namespace)\n            \n            if task_id and name:\n                tasks.append({\n                    'id': task_id,\n                    'name': name,\n                    'start': self._get_text(task, 'ns:Start' if namespace else 'Start', namespace),\n                    'finish': self._get_text(task, 'ns:Finish' if namespace else 'Finish', namespace),\n                    'duration': self._get_text(task, 'ns:Duration' if namespace else 'Duration', namespace),\n                    'work': self._get_text(task, 'ns:Work' if namespace else 'Work', namespace)\n                })\n        \n        return tasks\n    \n    def _parse_assignments(self, root, namespace):\n        \"\"\"Parse resource assignments\"\"\"\n        assignments = []\n        assignment_elements = root.findall('.//ns:Assignment', namespace) if namespace else root.findall('.//Assignment')\n        \n        for assignment in assignment_elements:\n            task_uid = self._get_text(assignment, 'ns:TaskUID' if namespace else 'TaskUID', namespace)\n            resource_uid = self._get_text(assignment, 'ns:ResourceUID' if namespace else 'ResourceUID', namespace)\n            work = self._get_text(assignment, 'ns:Work' if namespace else 'Work', namespace)\n            \n            if task_uid and resource_uid:\n                assignments.append({\n                    'task_id': task_uid,\n                    'resource_id': resource_uid,\n                    'work': work,\n                    'units': self._get_text(assignment, 'ns:Units' if namespace else 'Units', namespace, default='1.0')\n                })\n        \n        return assignments\n    \n    def _get_text(self, element, tag, namespace, default=''):\n        \"\"\"Helper to get text from XML element\"\"\"\n        try:\n            found = element.find(tag, namespace) if namespace else element.find(tag)\n            return found.text if found is not None and found.text else default\n        except:\n            return default\n    \n    def get_resource_workload_data(self, date_range_start=None, date_range_end=None):\n        \"\"\"\n        Calculate workload data for each resource.\n        \n        Args:\n            date_range_start: –ù–∞—á–∞–ª–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ (datetime.date or None)\n            date_range_end: –ö–æ–Ω–µ—Ü –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ (datetime.date or None)\n        \"\"\"\n        workload_data = []\n        \n        # Calculate project timeframe for capacity calculation\n        project_start = None\n        project_end = None\n        \n        for task in self.tasks:\n            if task['start']:\n                task_start = self._parse_date(task['start'])\n                if task_start and (project_start is None or task_start < project_start):\n                    project_start = task_start\n            \n            if task['finish']:\n                task_end = self._parse_date(task['finish'])\n                if task_end and (project_end is None or task_end > project_end):\n                    project_end = task_end\n        \n        # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –∏–ª–∏ –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç\n        if date_range_start and date_range_end:\n            # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å date –≤ datetime –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π\n            from datetime import datetime as dt_class\n            range_start_dt = dt_class.combine(date_range_start, dt_class.min.time())\n            range_end_dt = dt_class.combine(date_range_end, dt_class.max.time())\n        else:\n            range_start_dt = project_start\n            range_end_dt = project_end\n        \n        # Calculate total available work hours for the selected range\n        # MS Project model: 1 workday (P1D) = 8 hours\n        # Default capacity for resources is 8 hours per workday\n        if range_start_dt and range_end_dt:\n            range_duration = range_end_dt - range_start_dt\n            calendar_days = range_duration.total_seconds() / (24 * 3600)\n            \n            if calendar_days <= 0:\n                # Minimum: 1 workday\n                available_work_hours_base = 8\n            else:\n                # Count workdays (approximate: 5/7 of calendar days are workdays)\n                workdays = calendar_days * (5.0 / 7.0)\n                # 8 hours per workday\n                available_work_hours_base = workdays * 8\n        else:\n            # Default: 4 weeks = 20 workdays = 160 hours\n            available_work_hours_base = 160\n        \n        for resource in self.resources:\n            # Get all assignments for this resource\n            resource_assignments = [a for a in self.assignments if a['resource_id'] == resource['id']]\n            \n            # Calculate total work hours (only within date range)\n            total_work_hours = 0\n            task_details = []\n            \n            for assignment in resource_assignments:\n                # Get task info\n                task = next((t for t in self.tasks if t['id'] == assignment['task_id']), None)\n                if task and task['start'] and task['finish']:\n                    task_start = self._parse_date(task['start'])\n                    task_end = self._parse_date(task['finish'])\n                    \n                    if task_start and task_end and range_start_dt and range_end_dt:\n                        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ —Å –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º\n                        overlap_days, proportion = self.compute_overlap(\n                            task_start, task_end, range_start_dt, range_end_dt\n                        )\n                        \n                        if proportion > 0:\n                            # –£—á–∏—Ç—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —á–∞—Å—ã –ø–æ–ø–∞–¥–∞—é—â–∏–µ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω\n                            total_task_hours = self._parse_work_hours(assignment['work'])\n                            hours_in_range = total_task_hours * proportion\n                            total_work_hours += hours_in_range\n                            \n                            task_details.append({\n                                'task_name': task['name'],\n                                'work_hours': hours_in_range,\n                                'total_hours': total_task_hours,\n                                'proportion': proportion,\n                                'start': task.get('start', 'N/A'),\n                                'finish': task.get('finish', 'N/A')\n                            })\n                    else:\n                        # –ï—Å–ª–∏ –Ω–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω–∞, —É—á–∏—Ç—ã–≤–∞—Ç—å –≤—Å—é –∑–∞–¥–∞—á—É\n                        work_hours = self._parse_work_hours(assignment['work'])\n                        total_work_hours += work_hours\n                        task_details.append({\n                            'task_name': task['name'],\n                            'work_hours': work_hours,\n                            'start': task.get('start', 'N/A'),\n                            'finish': task.get('finish', 'N/A')\n                        })\n            \n            # Calculate capacity based on resource MaxUnits and available work hours\n            max_units = float(resource.get('max_units', 1.0))\n            # Capacity = available work hours √ó max_units\n            max_capacity = available_work_hours_base * max_units\n            workload_percentage = (total_work_hours / max_capacity) * 100 if max_capacity > 0 else 0\n            \n            # Calculate project weeks for display purposes\n            project_weeks = available_work_hours_base / 40\n            \n            workload_data.append({\n                'resource_name': resource['name'],\n                'total_work_hours': total_work_hours,\n                'max_capacity': max_capacity,\n                'workload_percentage': workload_percentage,\n                'task_count': len(resource_assignments),\n                'tasks': task_details,\n                'project_weeks': project_weeks\n            })\n        \n        return workload_data\n    \n    def _parse_date(self, date_string):\n        \"\"\"Parse date string to datetime object\"\"\"\n        if not date_string:\n            return None\n        \n        try:\n            # Try ISO format first\n            return datetime.fromisoformat(date_string.replace('Z', '+00:00'))\n        except:\n            try:\n                # Try common MS Project formats\n                for fmt in ['%Y-%m-%dT%H:%M:%S', '%Y-%m-%d %H:%M:%S', '%Y-%m-%d']:\n                    try:\n                        return datetime.strptime(date_string, fmt)\n                    except:\n                        continue\n            except:\n                pass\n        \n        return None\n    \n    def _parse_work_hours(self, work_string):\n        \"\"\"Parse work hours from MS Project ISO-8601 duration format (e.g., PT8H0M0S, P2DT4H0M0S)\"\"\"\n        if not work_string:\n            return 0\n        \n        try:\n            # MS Project uses ISO-8601 duration format: P[n]DT[n]H[n]M[n]S\n            # P2DT4H30M0S = 2 days, 4 hours, 30 minutes\n            hours = 0\n            \n            if work_string.startswith('P'):\n                # Extract days (assuming 8-hour workdays)\n                if 'D' in work_string:\n                    d_start = 1  # After 'P'\n                    d_end = work_string.index('D')\n                    days = float(work_string[d_start:d_end])\n                    hours += days * 8  # 8-hour workday\n                \n                # Extract hours\n                if 'H' in work_string:\n                    # Find start position (after 'T' or 'D')\n                    if 'T' in work_string:\n                        h_start = work_string.index('T') + 1\n                    else:\n                        h_start = work_string.index('D') + 1\n                    h_end = work_string.index('H')\n                    # Extract the number between start and 'H'\n                    h_str = work_string[h_start:h_end]\n                    # Remove any non-digit characters except '.'\n                    h_str = ''.join(c for c in h_str if c.isdigit() or c == '.')\n                    if h_str:\n                        hours += float(h_str)\n                \n                # Extract minutes\n                if 'M' in work_string and 'T' in work_string:\n                    m_start = work_string.index('H') + 1 if 'H' in work_string else work_string.index('T') + 1\n                    m_end = work_string.index('M')\n                    m_str = work_string[m_start:m_end]\n                    m_str = ''.join(c for c in m_str if c.isdigit() or c == '.')\n                    if m_str:\n                        minutes = float(m_str)\n                        hours += minutes / 60\n                \n                return hours\n            else:\n                # Try to parse as number\n                return float(work_string)\n        except Exception as e:\n            # Fallback to 0 if parsing fails\n            return 0\n    \n    def get_timeline_workload(self, date_range_start=None, date_range_end=None):\n        \"\"\"\n        –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É —Ä–µ—Å—É—Ä—Å–æ–≤ –ø–æ –Ω–µ–¥–µ–ª—è–º.\n        \n        Args:\n            date_range_start: –ù–∞—á–∞–ª–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ (datetime.date or None)\n            date_range_end: –ö–æ–Ω–µ—Ü –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ (datetime.date or None)\n        \"\"\"\n        timeline_data = {}\n        \n        # –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ–µ–∫—Ç–∞\n        project_start = None\n        project_end = None\n        \n        for task in self.tasks:\n            if task['start']:\n                task_start = self._parse_date(task['start'])\n                if task_start and (project_start is None or task_start < project_start):\n                    project_start = task_start\n            \n            if task['finish']:\n                task_end = self._parse_date(task['finish'])\n                if task_end and (project_end is None or task_end > project_end):\n                    project_end = task_end\n        \n        # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –∏–ª–∏ –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç\n        if date_range_start and date_range_end:\n            from datetime import datetime as dt_class\n            range_start_dt = dt_class.combine(date_range_start, dt_class.min.time())\n            range_end_dt = dt_class.combine(date_range_end, dt_class.max.time())\n        else:\n            range_start_dt = project_start\n            range_end_dt = project_end\n        \n        if not range_start_dt or not range_end_dt:\n            return {}\n        \n        # –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞\n        task_dict = {t['id']: t for t in self.tasks}\n        \n        # –°–æ–∑–¥–∞—Ç—å –Ω–µ–¥–µ–ª—å–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞\n        current_date = range_start_dt\n        weeks = []\n        while current_date <= range_end_dt:\n            week_end = current_date + timedelta(days=6)\n            weeks.append({\n                'start': current_date,\n                'end': min(week_end, range_end_dt),\n                'label': f\"{current_date.strftime('%d.%m')} - {min(week_end, range_end_dt).strftime('%d.%m')}\"\n            })\n            current_date = week_end + timedelta(days=1)\n        \n        # –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –ø–æ –Ω–µ–¥–µ–ª—è–º\n        for resource in self.resources:\n            resource_assignments = [a for a in self.assignments if a['resource_id'] == resource['id']]\n            weekly_loads = []\n            \n            for week in weeks:\n                week_hours = 0\n                \n                for assignment in resource_assignments:\n                    task = task_dict.get(assignment['task_id'])  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à\n                    if task and task['start'] and task['finish']:\n                        task_start = self._parse_date(task['start'])\n                        task_end = self._parse_date(task['finish'])\n                        \n                        if task_start and task_end:\n                            # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ —Å –Ω–µ–¥–µ–ª–µ–π\n                            overlap_start = max(task_start, week['start'])\n                            overlap_end = min(task_end, week['end'])\n                            \n                            if overlap_start <= overlap_end:\n                                # –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–æ–ª—é —Ä–∞–±–æ—Ç—ã –≤ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ\n                                task_total_hours = self._parse_work_hours(assignment['work'])\n                                task_duration_days = (task_end - task_start).days + 1\n                                overlap_days = (overlap_end - overlap_start).days + 1\n                                \n                                if task_duration_days > 0:\n                                    proportion = overlap_days / task_duration_days\n                                    week_hours += task_total_hours * proportion\n                \n                # –Å–º–∫–æ—Å—Ç—å –∑–∞ –Ω–µ–¥–µ–ª—é: 5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π √ó 8 —á–∞—Å–æ–≤ √ó max_units\n                max_units = float(resource.get('max_units', 1.0))\n                week_capacity = 40 * max_units\n                week_percentage = (week_hours / week_capacity) * 100 if week_capacity > 0 else 0\n                \n                weekly_loads.append({\n                    'week': week['label'],\n                    'week_start': week['start'],\n                    'week_end': week['end'],\n                    'hours': week_hours,\n                    'capacity': week_capacity,\n                    'percentage': week_percentage\n                })\n            \n            timeline_data[resource['name']] = weekly_loads\n        \n        return timeline_data\n    \n    def get_project_dates(self):\n        \"\"\"–ü–æ–ª—É—á–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–∞—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞\"\"\"\n        project_start = None\n        project_end = None\n        \n        for task in self.tasks:\n            if task['start']:\n                task_start = self._parse_date(task['start'])\n                if task_start and (project_start is None or task_start < project_start):\n                    project_start = task_start\n            \n            if task['finish']:\n                task_end = self._parse_date(task['finish'])\n                if task_end and (project_end is None or task_end > project_end):\n                    project_end = task_end\n        \n        return project_start, project_end\n    \n    @staticmethod\n    def compute_overlap(task_start, task_end, range_start, range_end):\n        \"\"\"\n        –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º.\n        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (overlap_days, proportion) –≥–¥–µ:\n        - overlap_days: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è\n        - proportion: –¥–æ–ª—è –∑–∞–¥–∞—á–∏ –ø–æ–ø–∞–¥–∞—é—â–∞—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω (0.0-1.0)\n        \"\"\"\n        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞–¥–∞—á–∞ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è —Å –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º\n        if task_end < range_start or task_start > range_end:\n            return 0, 0.0\n        \n        # –ù–∞–π—Ç–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ\n        overlap_start = max(task_start, range_start)\n        overlap_end = min(task_end, range_end)\n        \n        # –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–Ω–∏\n        overlap_days = (overlap_end - overlap_start).days + 1\n        task_total_days = (task_end - task_start).days + 1\n        \n        # –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø—Ä–æ–ø–æ—Ä—Ü–∏—é\n        proportion = overlap_days / task_total_days if task_total_days > 0 else 0.0\n        \n        return max(0, overlap_days), max(0.0, min(1.0, proportion))\n\n# Analysis functions\ndef analyze_workload(workload_data):\n    \"\"\"Analyze workload and categorize resources\"\"\"\n    analysis = {\n        'overloaded': [],\n        'optimal': [],\n        'underutilized': []\n    }\n    \n    for item in workload_data:\n        percentage = item['workload_percentage']\n        if percentage > 100:\n            analysis['overloaded'].append(item)\n        elif percentage >= 70:\n            analysis['optimal'].append(item)\n        else:\n            analysis['underutilized'].append(item)\n    \n    return analysis\n\ndef optimize_with_task_shifting(parser, settings, date_range_start=None, date_range_end=None, selected_resources=None):\n    \"\"\"\n    –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å —Å–º–µ—â–µ–Ω–∏–µ–º –∑–∞–¥–∞—á –≤–æ –≤—Ä–µ–º–µ–Ω–∏\n    \n    Args:\n        parser: MSProjectParser instance\n        settings: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏\n            {\n                'max_shift_days': int,  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –∑–∞–¥–∞—á –≤ –¥–Ω—è—Ö\n                'target_load': float,   # –¶–µ–ª–µ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (70-100%)\n                'mode': 'balance'       # –†–µ–∂–∏–º: 'balance' –∏–ª–∏ 'minimize_peaks'\n            }\n        date_range_start: –ù–∞—á–∞–ª–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ (datetime.date or None)\n        date_range_end: –ö–æ–Ω–µ—Ü –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ (datetime.date or None)\n        selected_resources: –°–ø–∏—Å–æ–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (list or None)\n    \"\"\"\n    max_shift = settings.get('max_shift_days', 14)\n    target_load = settings.get('target_load', 85)\n    mode = settings.get('mode', 'balance')\n    \n    # –ü–æ–ª—É—á–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –∏ –∫—ç—à –∑–∞–¥–∞—á —Å —É—á—ë—Ç–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–∞\n    timeline_data = parser.get_timeline_workload(date_range_start, date_range_end)\n    task_dict = {t['id']: t for t in parser.tasks}\n    \n    # –ù–∞–π—Ç–∏ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞\n    optimization_suggestions = []\n    \n    for resource_name, weekly_loads in timeline_data.items():\n        # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º\n        if selected_resources and resource_name not in selected_resources:\n            continue\n        # –ù–∞–π—Ç–∏ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏ –Ω–µ–¥–æ–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –Ω–µ–¥–µ–ª–∏\n        overloaded_weeks = {}\n        underloaded_weeks = {}\n        \n        for i, week_data in enumerate(weekly_loads):\n            if week_data['percentage'] > 100:\n                overloaded_weeks[i] = week_data\n            elif week_data['percentage'] < target_load:\n                underloaded_weeks[i] = week_data\n        \n        if not overloaded_weeks:\n            continue\n        \n        # –ù–∞–π—Ç–∏ –∑–∞–¥–∞—á–∏ —ç—Ç–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞\n        resource = next((r for r in parser.resources if r['name'] == resource_name), None)\n        if not resource:\n            continue\n        \n        resource_assignments = [a for a in parser.assignments if a['resource_id'] == resource['id']]\n        \n        # –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—Ä—Ç—É –Ω–µ–¥–µ–ª—å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ (–æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ —Ä–µ—Å—É—Ä—Å)\n        # –ö–†–ò–¢–ò–ß–ù–û: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ –¥–∏–∞–ø–∞–∑–æ–Ω —á—Ç–æ –∏ –≤ get_timeline_workload()\n        project_start = None\n        project_end = None\n        for task_item in parser.tasks:\n            if task_item['start']:\n                ts = parser._parse_date(task_item['start'])\n                if ts and (project_start is None or ts < project_start):\n                    project_start = ts\n            if task_item['finish']:\n                te = parser._parse_date(task_item['finish'])\n                if te and (project_end is None or te > project_end):\n                    project_end = te\n        \n        # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –∏–ª–∏ –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç\n        if date_range_start and date_range_end:\n            from datetime import datetime as dt_class\n            range_start_dt = dt_class.combine(date_range_start, dt_class.min.time())\n            range_end_dt = dt_class.combine(date_range_end, dt_class.max.time())\n        else:\n            range_start_dt = project_start\n            range_end_dt = project_end\n        \n        if not range_start_dt or not range_end_dt:\n            continue\n            \n        current_date = range_start_dt\n        weeks_with_dates = []\n        while current_date <= range_end_dt:\n            week_end = current_date + timedelta(days=6)\n            weeks_with_dates.append({\n                'start': current_date,\n                'end': min(week_end, range_end_dt),\n                'index': len(weeks_with_dates)\n            })\n            current_date = week_end + timedelta(days=1)\n        \n        # –î–ª—è –∫–∞–∂–¥–æ–π –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω–æ–π –Ω–µ–¥–µ–ª–∏ –Ω–∞–π—Ç–∏ –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ —Å–¥–≤–∏–Ω—É—Ç—å\n        for week_idx, week_data in overloaded_weeks.items():\n            excess_hours = week_data['hours'] - week_data['capacity']\n            \n            # –ü–æ–ª—É—á–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏\n            if week_idx >= len(weeks_with_dates):\n                continue\n            current_week_info = weeks_with_dates[week_idx]\n            week_start = current_week_info['start']\n            week_end = current_week_info['end']\n            \n            # –ù–∞–π—Ç–∏ –∑–∞–¥–∞—á–∏, –ø–µ—Ä–µ—Å–µ–∫–∞—é—â–∏–µ—Å—è —Å —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π\n            tasks_in_week = []\n            for assignment in resource_assignments:\n                task = task_dict.get(assignment['task_id'])\n                if not task or not task['start'] or not task['finish']:\n                    continue\n                \n                task_start = parser._parse_date(task['start'])\n                task_end = parser._parse_date(task['finish'])\n                if not task_start or not task_end:\n                    continue\n                \n                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–¥–∞—á–∞ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è —Å —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–µ–π\n                if task_end < week_start or task_start > week_end:\n                    continue  # –ó–∞–¥–∞—á–∞ –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è —Å —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ–π\n                \n                task_hours = parser._parse_work_hours(assignment['work'])\n                tasks_in_week.append({\n                    'task': task,\n                    'assignment': assignment,\n                    'start': task_start,\n                    'end': task_end,\n                    'hours': task_hours\n                })\n            \n            # –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–¥–≤–∏–Ω—É—Ç—å –∑–∞–¥–∞—á–∏ –≤ –Ω–µ–¥–æ–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã\n            for task_info in sorted(tasks_in_week, key=lambda x: x['hours'], reverse=True):\n                task = task_info['task']\n                task_start = task_info['start']\n                task_end = task_info['end']\n                task_hours = task_info['hours']\n                \n                best_shift = None\n                best_improvement = 0\n                \n                # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–¥–≤–∏–≥–∏\n                for shift_days in range(1, max_shift + 1):\n                    new_start = task_start + timedelta(days=shift_days)\n                    new_end = task_end + timedelta(days=shift_days)\n                    \n                    # –ù–∞–π—Ç–∏ –≤—Å–µ –Ω–µ–¥–µ–ª–∏, –≤ –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ø–∞–¥—ë—Ç —Å–¥–≤–∏–Ω—É—Ç–∞—è –∑–∞–¥–∞—á–∞\n                    overlapping_weeks = []\n                    for week_info in weeks_with_dates:\n                        overlap_start = max(new_start, week_info['start'])\n                        overlap_end = min(new_end, week_info['end'])\n                        \n                        if overlap_start <= overlap_end:\n                            # –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–æ–ª—é –∑–∞–¥–∞—á–∏ –≤ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ\n                            task_duration_days = (task_end - task_start).days + 1\n                            overlap_days = (overlap_end - overlap_start).days + 1\n                            proportion = overlap_days / task_duration_days if task_duration_days > 0 else 0\n                            hours_in_week = task_hours * proportion\n                            \n                            overlapping_weeks.append({\n                                'index': week_info['index'],\n                                'hours': hours_in_week,\n                                'proportion': proportion\n                            })\n                    \n                    if not overlapping_weeks:\n                        continue\n                    \n                    # –í—ã–±—Ä–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é —Ü–µ–ª–µ–≤—É—é –Ω–µ–¥–µ–ª—é (—Å –Ω–∞–∏–±–æ–ª—å—à–µ–π –¥–æ–ª–µ–π –∑–∞–¥–∞—á–∏)\n                    main_target = max(overlapping_weeks, key=lambda w: w['proportion'])\n                    target_week_idx = main_target['index']\n                    \n                    if target_week_idx == week_idx or target_week_idx >= len(weekly_loads):\n                        continue\n                    \n                    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ü–µ–ª–µ–≤–∞—è –Ω–µ–¥–µ–ª—è –º–µ–Ω–µ–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞\n                    target_week = weekly_loads[target_week_idx]\n                    \n                    # –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –≤ —á–∞—Å–∞—Ö\n                    # –°–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤ –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è –≤ –∏—Å—Ö–æ–¥–Ω–æ–π –Ω–µ–¥–µ–ª–µ\n                    hours_removed_from_source = task_hours  # –£–ø—Ä–æ—â–µ–Ω–∏–µ: –≤—Å—è –∑–∞–¥–∞—á–∞ —É—Ö–æ–¥–∏—Ç\n                    # –°–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤ –¥–æ–±–∞–≤–∏—Ç—Å—è –≤ —Ü–µ–ª–µ–≤—É—é –Ω–µ–¥–µ–ª—é\n                    hours_added_to_target = main_target['hours']\n                    \n                    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–¥–≤–∏–≥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–∂–∞–µ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫—É\n                    new_source_hours = week_data['hours'] - hours_removed_from_source\n                    new_source_percentage = (new_source_hours / week_data['capacity']) * 100 if week_data['capacity'] > 0 else 0\n                    \n                    new_target_hours = target_week['hours'] + hours_added_to_target\n                    new_target_percentage = (new_target_hours / target_week['capacity']) * 100 if target_week['capacity'] > 0 else 0\n                    \n                    # –£—Å–ª–æ–≤–∏—è: –∏—Å—Ö–æ–¥–Ω–∞—è –Ω–µ–¥–µ–ª—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º–µ–Ω–µ–µ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω–æ–π, —Ü–µ–ª–µ–≤–∞—è –Ω–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω–æ–π\n                    if new_source_percentage < week_data['percentage'] and new_target_percentage <= 100:\n                        # –û—Ü–µ–Ω–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ –∫–∞–∫ —Å–Ω–∏–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏\n                        improvement = week_data['percentage'] - new_source_percentage\n                        \n                        if improvement > best_improvement:\n                            best_improvement = improvement\n                            best_shift = shift_days\n                \n                # –ï—Å–ª–∏ –Ω–∞—à–ª–∏ —Ö–æ—Ä–æ—à–∏–π —Å–¥–≤–∏–≥, –¥–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é\n                if best_shift:\n                    new_start = task_start + timedelta(days=best_shift)\n                    new_end = task_end + timedelta(days=best_shift)\n                    \n                    optimization_suggestions.append({\n                        'type': 'shift_task',\n                        'resource': resource_name,\n                        'task_name': task['name'],\n                        'task_hours': task_hours,\n                        'original_start': task_start.strftime('%Y-%m-%d'),\n                        'original_end': task_end.strftime('%Y-%m-%d'),\n                        'suggested_start': new_start.strftime('%Y-%m-%d'),\n                        'suggested_end': new_end.strftime('%Y-%m-%d'),\n                        'shift_days': best_shift,\n                        'improvement': f'{best_improvement:.1f}%',\n                        'reason': f'–°–Ω–∏–∑–∏—Ç—å –ø–µ—Ä–µ–≥—Ä—É–∑–∫—É –Ω–∞ {excess_hours:.1f}—á –≤ –Ω–µ–¥–µ–ª—é {week_data[\"week\"]}',\n                        'priority': '–í—ã—Å–æ–∫–∏–π' if week_data['percentage'] > 120 else '–°—Ä–µ–¥–Ω–∏–π'\n                    })\n                    \n                    # –î–ª—è —Ä–µ–∂–∏–º–∞ balance –±–µ—Ä—ë–º —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –∑–∞–¥–∞—á—É –Ω–∞ –Ω–µ–¥–µ–ª—é\n                    if mode == 'balance':\n                        break\n    \n    return optimization_suggestions\n\ndef generate_recommendations(analysis):\n    \"\"\"Generate actionable recommendations based on actual resource capacity\"\"\"\n    recommendations = []\n    \n    overloaded = analysis['overloaded']\n    underutilized = analysis['underutilized']\n    \n    if overloaded and underutilized:\n        for overloaded_resource in overloaded:\n            for underutilized_resource in underutilized:\n                # Calculate excess hours based on actual capacity\n                overload_percentage = overloaded_resource['workload_percentage'] - 100\n                excess_hours = (overload_percentage / 100) * overloaded_resource['max_capacity']\n                \n                # Calculate available capacity\n                underutil_percentage = 100 - underutilized_resource['workload_percentage']\n                available_capacity = (underutil_percentage / 100) * underutilized_resource['max_capacity']\n                \n                if available_capacity > 0:\n                    hours_to_move = min(excess_hours, available_capacity)\n                    recommendations.append({\n                        'type': 'Reassign Tasks',\n                        'from': overloaded_resource['resource_name'],\n                        'to': underutilized_resource['resource_name'],\n                        'hours': hours_to_move,\n                        'priority': 'High' if overloaded_resource['workload_percentage'] > 120 else 'Medium'\n                    })\n    \n    elif overloaded and not underutilized:\n        for resource in overloaded:\n            overload_percentage = resource['workload_percentage'] - 100\n            excess_hours = (overload_percentage / 100) * resource['max_capacity']\n            recommendations.append({\n                'type': 'Hire Additional Resources',\n                'resource': resource['resource_name'],\n                'reason': f'Overloaded by {resource[\"workload_percentage\"] - 100:.1f}% ({excess_hours:.1f} hours)',\n                'priority': 'High' if resource['workload_percentage'] > 120 else 'Medium'\n            })\n    \n    elif underutilized:\n        for resource in underutilized:\n            underutil_percentage = 100 - resource['workload_percentage']\n            available_hours = (underutil_percentage / 100) * resource['max_capacity']\n            recommendations.append({\n                'type': 'Increase Utilization',\n                'resource': resource['resource_name'],\n                'available_capacity': f'{100 - resource[\"workload_percentage\"]:.1f}% ({available_hours:.1f} hours)',\n                'priority': 'Low'\n            })\n    \n    return recommendations\n\ndef export_to_csv(workload_df, analysis, parser=None, timeline_data=None, optimization_results=None, date_start=None, date_end=None, business_days=None, capacity=None):\n    \"\"\"\n    –≠–∫—Å–ø–æ—Ä—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤ CSV —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–µ–∫—Ü–∏—è–º–∏:\n    1. –ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)\n    2. –°–≤–æ–¥–∫–∞ –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º (–≤—Å–µ–≥–¥–∞)\n    3. –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º (–µ—Å–ª–∏ –µ—Å—Ç—å parser)\n    4. –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –Ω–µ–¥–µ–ª—è–º (–µ—Å–ª–∏ –µ—Å—Ç—å timeline_data)\n    5. –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å optimization_results)\n    \"\"\"\n    import re\n    \n    def remove_emojis(text):\n        \"\"\"–£–¥–∞–ª–∏—Ç—å emoji –∏–∑ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å cp1251\"\"\"\n        if isinstance(text, str):\n            # –£–¥–∞–ª–∏—Ç—å emoji –∏ –¥—Ä—É–≥–∏–µ —Å–∏–º–≤–æ–ª—ã Unicode –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ cp1251\n            return re.sub(r'[^\\u0000-\\u04FF]', '', text)\n        return text\n    \n    csv_buffer = io.StringIO()\n    \n    # –ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)\n    if date_start and date_end:\n        period_str = f\"{date_start.strftime('%d.%m.%Y')} - {date_end.strftime('%d.%m.%Y')}\"\n        csv_buffer.write(f\"–ü–ï–†–ò–û–î –ê–ù–ê–õ–ò–ó–ê: {period_str}\\n\")\n        if business_days is not None:\n            csv_buffer.write(f\"–†–∞–±–æ—á–∏–µ –¥–Ω–∏: {business_days}\\n\")\n        if capacity is not None:\n            csv_buffer.write(f\"–†–∞–±–æ—á–∞—è —ë–º–∫–æ—Å—Ç—å –Ω–∞ —á–µ–ª–æ–≤–µ–∫–∞: {capacity} —á.\\n\")\n        csv_buffer.write(\"\\n\")\n    \n    # –û—á–∏—Å—Ç–∏—Ç—å DataFrame –æ—Ç emoji –ø–µ—Ä–µ–¥ —ç–∫—Å–ø–æ—Ä—Ç–æ–º\n    df_clean = workload_df.copy()\n    for col in df_clean.columns:\n        if df_clean[col].dtype == 'object':\n            df_clean[col] = df_clean[col].apply(remove_emojis)\n    \n    # –°–µ–∫—Ü–∏—è 1: –°–≤–æ–¥–∫–∞ –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º\n    csv_buffer.write(\"–°–í–û–î–ö–ê –ü–û –†–ï–°–£–†–°–ê–ú\\n\")\n    df_clean.to_csv(csv_buffer, index=False)\n    csv_buffer.write(\"\\n\\n\")\n    \n    # –°–µ–∫—Ü–∏—è 2: –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º\n    if parser:\n        csv_buffer.write(\"–î–ï–¢–ê–õ–ò–ó–ê–¶–ò–Ø –ó–ê–î–ê–ß –ü–û –†–ï–°–£–†–°–ê–ú\\n\")\n        csv_buffer.write(\"–†–µ—Å—É—Ä—Å,ID –∑–∞–¥–∞—á–∏,–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏,–ù–∞—á–∞–ª–æ,–ö–æ–Ω–µ—Ü,–¢—Ä—É–¥–æ—ë–º–∫–æ—Å—Ç—å (—á–∞—Å—ã)\\n\")\n        \n        for resource in parser.resources:\n            resource_name = resource['name']\n            resource_assignments = [a for a in parser.assignments if a['resource_id'] == resource['id']]\n            \n            for assignment in resource_assignments:\n                task = next((t for t in parser.tasks if t['id'] == assignment['task_id']), None)\n                if task:\n                    task_id = task.get('id', '')\n                    task_name = task.get('name', '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')\n                    task_start = task.get('start', '')\n                    task_finish = task.get('finish', '')\n                    task_hours = parser._parse_work_hours(assignment['work'])\n                    \n                    csv_buffer.write(f'\"{resource_name}\",\"{task_id}\",\"{task_name}\",\"{task_start}\",\"{task_finish}\",{task_hours:.2f}\\n')\n        csv_buffer.write(\"\\n\\n\")\n    \n    # –°–µ–∫—Ü–∏—è 3: –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –Ω–µ–¥–µ–ª—è–º\n    if timeline_data:\n        csv_buffer.write(\"–í–†–ï–ú–ï–ù–ù–û–ï –†–ê–°–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ü–û –ù–ï–î–ï–õ–Ø–ú\\n\")\n        csv_buffer.write(\"–†–µ—Å—É—Ä—Å,–ù–µ–¥–µ–ª—è –Ω–∞—á–∞–ª–æ,–ù–µ–¥–µ–ª—è –∫–æ–Ω–µ—Ü,–ß–∞—Å—ã,–Å–º–∫–æ—Å—Ç—å,–ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏\\n\")\n        \n        for resource_name, weekly_loads in timeline_data.items():\n            for week_data in weekly_loads:\n                week_start = week_data['week_start'].strftime('%Y-%m-%d')\n                week_end = week_data['week_end'].strftime('%Y-%m-%d')\n                hours = week_data['hours']\n                capacity = week_data['capacity']\n                percentage = week_data['percentage']\n                \n                csv_buffer.write(f'\"{resource_name}\",{week_start},{week_end},{hours:.2f},{capacity:.2f},{percentage:.2f}\\n')\n        csv_buffer.write(\"\\n\\n\")\n    \n    # –°–µ–∫—Ü–∏—è 4: –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏\n    if optimization_results:\n        csv_buffer.write(\"–ü–†–ï–î–õ–û–ñ–ï–ù–ò–Ø –ü–û –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò\\n\")\n        csv_buffer.write(\"–†–µ—Å—É—Ä—Å,–ó–∞–¥–∞—á–∞,–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞—Ç—ã,–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–µ –¥–∞—Ç—ã,–°–º–µ—â–µ–Ω–∏–µ (–¥–Ω–∏),–£–ª—É—á—à–µ–Ω–∏–µ,–ü—Ä–∏—á–∏–Ω–∞,–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç\\n\")\n        \n        for suggestion in optimization_results:\n            resource = suggestion.get('resource', '')\n            task_name = suggestion.get('task_name', '')\n            orig_dates = f\"{suggestion.get('original_start', '')} - {suggestion.get('original_end', '')}\"\n            sugg_dates = f\"{suggestion.get('suggested_start', '')} - {suggestion.get('suggested_end', '')}\"\n            shift_days = suggestion.get('shift_days', '')\n            improvement = suggestion.get('improvement', '')\n            reason = suggestion.get('reason', '')\n            priority = suggestion.get('priority', '')\n            \n            csv_buffer.write(f'\"{resource}\",\"{task_name}\",\"{orig_dates}\",\"{sugg_dates}\",{shift_days},\"{improvement}\",\"{reason}\",\"{priority}\"\\n')\n        csv_buffer.write(\"\\n\")\n    \n    # –ö–æ–¥–∏—Ä–æ–≤–∫–∞ cp1251 –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å Excel\n    return csv_buffer.getvalue().encode('cp1251')\n\ndef export_to_pdf(workload_df, analysis, recommendations, parser=None, timeline_data=None, optimization_results=None, date_start=None, date_end=None, business_days=None, capacity=None):\n    \"\"\"\n    –≠–∫—Å–ø–æ—Ä—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤ PDF —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–µ–∫—Ü–∏—è–º–∏:\n    1. –ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)\n    2. –°–≤–æ–¥–∫–∞ –∏ —Ç–∞–±–ª–∏—Ü–∞ —Ä–∞–±–æ—á–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏ (–≤—Å–µ–≥–¥–∞)\n    3. –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º (–µ—Å–ª–∏ –µ—Å—Ç—å parser)\n    4. –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –Ω–µ–¥–µ–ª—è–º (–µ—Å–ª–∏ –µ—Å—Ç—å timeline_data)\n    5. –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å optimization_results)\n    \"\"\"\n    # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ DejaVu –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã\n    dejavu_available = False\n    try:\n        pdfmetrics.registerFont(TTFont('DejaVuSans', '/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf'))\n        pdfmetrics.registerFont(TTFont('DejaVuSans-Bold', '/usr/share/fonts/truetype/dejavu/DejaVuSans-Bold.ttf'))\n        dejavu_available = True\n    except:\n        pass  # –ï—Å–ª–∏ —à—Ä–∏—Ñ—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ Helvetica\n    \n    buffer = io.BytesIO()\n    doc = SimpleDocTemplate(buffer, pagesize=letter)\n    elements = []\n    styles = getSampleStyleSheet()\n    \n    # –í—ã–±—Ä–∞—Ç—å —à—Ä–∏—Ñ—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ DejaVu\n    if dejavu_available:\n        normal_font = 'DejaVuSans'\n        bold_font = 'DejaVuSans-Bold'\n        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Å—Ç–∏–ª–µ–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è DejaVu Sans\n        for style_name in styles.byName:\n            style = styles[style_name]\n            style.fontName = normal_font\n    else:\n        normal_font = 'Helvetica'\n        bold_font = 'Helvetica-Bold'\n    \n    # –ó–∞–≥–æ–ª–æ–≤–æ–∫\n    title_style = ParagraphStyle(\n        'CustomTitle',\n        parent=styles['Heading1'],\n        fontSize=24,\n        fontName=bold_font,\n        textColor=colors.HexColor('#0078D4'),\n        spaceAfter=30\n    )\n    elements.append(Paragraph(\"–û—Ç—á—ë—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É —Ä–∞–±–æ—á–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤\", title_style))\n    elements.append(Spacer(1, 0.2*inch))\n    \n    # –ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)\n    if date_start and date_end:\n        period_str = f\"{date_start.strftime('%d.%m.%Y')} - {date_end.strftime('%d.%m.%Y')}\"\n        period_text = f\"<b>–ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞:</b> {period_str}\"\n        if business_days is not None:\n            period_text += f\"<br/><b>–†–∞–±–æ—á–∏–µ –¥–Ω–∏:</b> {business_days}\"\n        if capacity is not None:\n            period_text += f\"<br/><b>–†–∞–±–æ—á–∞—è —ë–º–∫–æ—Å—Ç—å –Ω–∞ —á–µ–ª–æ–≤–µ–∫–∞:</b> {capacity} —á.\"\n        elements.append(Paragraph(period_text, styles['Normal']))\n        elements.append(Spacer(1, 0.2*inch))\n    \n    # –°–≤–æ–¥–∫–∞\n    summary_text = f\"\"\"\n    <b>–°–≤–æ–¥–∫–∞ –∞–Ω–∞–ª–∏–∑–∞</b><br/>\n    –°–æ–∑–¥–∞–Ω–æ: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}<br/>\n    –í—Å–µ–≥–æ —Ä–µ—Å—É—Ä—Å–æ–≤: {len(workload_df)}<br/>\n    –ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–æ: {len(analysis['overloaded'])}<br/>\n    –û–ø—Ç–∏–º–∞–ª—å–Ω–æ: {len(analysis['optimal'])}<br/>\n    –ù–µ–¥–æ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: {len(analysis['underutilized'])}\n    \"\"\"\n    elements.append(Paragraph(summary_text, styles['Normal']))\n    elements.append(Spacer(1, 0.3*inch))\n    \n    # –¢–∞–±–ª–∏—Ü–∞ —Ä–∞–±–æ—á–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏\n    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Å—Ç–æ–ª–±—Ü–æ–≤\n    has_period_hours = '–†–∞–±–æ—á–∏–µ —á–∞—Å—ã –∑–∞ –ø–µ—Ä–∏–æ–¥' in workload_df.columns\n    has_percentage_col = '–ù–∞–≥—Ä—É–∑–∫–∞ %' in workload_df.columns\n    has_hours_col = '–ó–∞–≥—Ä—É–∑–∫–∞ (—á–∞—Å—ã)' in workload_df.columns\n    \n    # –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã\n    if has_period_hours:\n        if has_hours_col:\n            table_data = [['–†–µ—Å—É—Ä—Å', '–í—ã–¥–µ–ª–µ–Ω–æ', '–Å–º–∫–æ—Å—Ç—å', '–ß–∞—Å—ã –∑–∞ –ø–µ—Ä–∏–æ–¥', '–ó–∞–≥—Ä—É–∑–∫–∞ (—á)', '–ó–∞–¥–∞—á–∏', '–°—Ç–∞—Ç—É—Å']]\n        else:\n            table_data = [['–†–µ—Å—É—Ä—Å', '–í—ã–¥–µ–ª–µ–Ω–æ', '–Å–º–∫–æ—Å—Ç—å', '–ß–∞—Å—ã –∑–∞ –ø–µ—Ä–∏–æ–¥', '–ù–∞–≥—Ä—É–∑–∫–∞ %', '–ó–∞–¥–∞—á–∏', '–°—Ç–∞—Ç—É—Å']]\n    else:\n        if has_hours_col:\n            table_data = [['–†–µ—Å—É—Ä—Å', '–í—ã–¥–µ–ª–µ–Ω–æ', '–Å–º–∫–æ—Å—Ç—å', '–ó–∞–≥—Ä—É–∑–∫–∞ (—á)', '–ó–∞–¥–∞—á–∏', '–°—Ç–∞—Ç—É—Å']]\n        else:\n            table_data = [['–†–µ—Å—É—Ä—Å', '–í—ã–¥–µ–ª–µ–Ω–æ', '–Å–º–∫–æ—Å—Ç—å', '–ù–∞–≥—Ä—É–∑–∫–∞ %', '–ó–∞–¥–∞—á–∏', '–°—Ç–∞—Ç—É—Å']]\n    \n    for _, row in workload_df.iterrows():\n        # –í—ã—á–∏—Å–ª–∏—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞\n        if has_percentage_col:\n            percentage = row['–ù–∞–≥—Ä—É–∑–∫–∞ %']\n        elif has_hours_col and row['–Å–º–∫–æ—Å—Ç—å —á–∞—Å–æ–≤'] > 0:\n            percentage = (row['–ó–∞–≥—Ä—É–∑–∫–∞ (—á–∞—Å—ã)'] / row['–Å–º–∫–æ—Å—Ç—å —á–∞—Å–æ–≤']) * 100\n        else:\n            percentage = 0\n        \n        status = '–ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω' if percentage > 100 else ('–û–ø—Ç–∏–º–∞–ª—å–Ω–æ' if percentage >= 70 else '–ù–µ–¥–æ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è')\n        \n        # –§–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è –∫–æ–ª–æ–Ω–æ–∫\n        if has_period_hours:\n            if has_hours_col:\n                table_data.append([\n                    row['–ò–º—è —Ä–µ—Å—É—Ä—Å–∞'],\n                    f\"{row['–í—ã–¥–µ–ª–µ–Ω–æ —á–∞—Å–æ–≤']:.1f}—á\",\n                    f\"{row['–Å–º–∫–æ—Å—Ç—å —á–∞—Å–æ–≤']:.1f}—á\",\n                    f\"{row['–†–∞–±–æ—á–∏–µ —á–∞—Å—ã –∑–∞ –ø–µ—Ä–∏–æ–¥']:.1f}—á\",\n                    f\"{row['–ó–∞–≥—Ä—É–∑–∫–∞ (—á–∞—Å—ã)']:.1f}—á\",\n                    str(row['–ö–æ–ª-–≤–æ –∑–∞–¥–∞—á']),\n                    status\n                ])\n            else:\n                table_data.append([\n                    row['–ò–º—è —Ä–µ—Å—É—Ä—Å–∞'],\n                    f\"{row['–í—ã–¥–µ–ª–µ–Ω–æ —á–∞—Å–æ–≤']:.1f}—á\",\n                    f\"{row['–Å–º–∫–æ—Å—Ç—å —á–∞—Å–æ–≤']:.1f}—á\",\n                    f\"{row['–†–∞–±–æ—á–∏–µ —á–∞—Å—ã –∑–∞ –ø–µ—Ä–∏–æ–¥']:.1f}—á\",\n                    f\"{row['–ù–∞–≥—Ä—É–∑–∫–∞ %']:.1f}%\",\n                    str(row['–ö–æ–ª-–≤–æ –∑–∞–¥–∞—á']),\n                    status\n                ])\n        else:\n            if has_hours_col:\n                table_data.append([\n                    row['–ò–º—è —Ä–µ—Å—É—Ä—Å–∞'],\n                    f\"{row['–í—ã–¥–µ–ª–µ–Ω–æ —á–∞—Å–æ–≤']:.1f}—á\",\n                    f\"{row['–Å–º–∫–æ—Å—Ç—å —á–∞—Å–æ–≤']:.1f}—á\",\n                    f\"{row['–ó–∞–≥—Ä—É–∑–∫–∞ (—á–∞—Å—ã)']:.1f}—á\",\n                    str(row['–ö–æ–ª-–≤–æ –∑–∞–¥–∞—á']),\n                    status\n                ])\n            else:\n                table_data.append([\n                    row['–ò–º—è —Ä–µ—Å—É—Ä—Å–∞'],\n                    f\"{row['–í—ã–¥–µ–ª–µ–Ω–æ —á–∞—Å–æ–≤']:.1f}—á\",\n                    f\"{row['–Å–º–∫–æ—Å—Ç—å —á–∞—Å–æ–≤']:.1f}—á\",\n                    f\"{row['–ù–∞–≥—Ä—É–∑–∫–∞ %']:.1f}%\",\n                    str(row['–ö–æ–ª-–≤–æ –∑–∞–¥–∞—á']),\n                    status\n                ])\n    \n    table = Table(table_data)\n    table.setStyle(TableStyle([\n        ('BACKGROUND', (0, 0), (-1, 0), colors.HexColor('#0078D4')),\n        ('TEXTCOLOR', (0, 0), (-1, 0), colors.whitesmoke),\n        ('ALIGN', (0, 0), (-1, -1), 'CENTER'),\n        ('FONTNAME', (0, 0), (-1, 0), bold_font),\n        ('FONTNAME', (0, 1), (-1, -1), normal_font),\n        ('FONTSIZE', (0, 0), (-1, 0), 12),\n        ('BOTTOMPADDING', (0, 0), (-1, 0), 12),\n        ('BACKGROUND', (0, 1), (-1, -1), colors.beige),\n        ('GRID', (0, 0), (-1, -1), 1, colors.black)\n    ]))\n    \n    elements.append(table)\n    elements.append(Spacer(1, 0.3*inch))\n    \n    # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\n    if recommendations:\n        heading_style = ParagraphStyle(\n            'CustomHeading2',\n            parent=styles['Heading2'],\n            fontName=bold_font\n        )\n        elements.append(Paragraph(\"<b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</b>\", heading_style))\n        for i, rec in enumerate(recommendations[:10], 1):\n            if rec['type'] == 'Reassign Tasks':\n                rec_text = f\"{i}. –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∑–∞–¥–∞—á–∏ - –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ {rec['hours']:.1f}—á –æ—Ç {rec['from']} –∫ {rec['to']}\"\n            elif rec['type'] == 'Hire Additional Resources':\n                rec_text = f\"{i}. –ù–∞–Ω—è—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è {rec['resource']}: {rec['reason']}\"\n            else:\n                rec_text = f\"{i}. –£–≤–µ–ª–∏—á–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ {rec['resource']}: {rec['available_capacity']}\"\n            elements.append(Paragraph(rec_text, styles['Normal']))\n    \n    # –°–µ–∫—Ü–∏—è: –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º\n    if parser:\n        elements.append(Spacer(1, 0.5*inch))\n        heading_style = ParagraphStyle(\n            'CustomHeading2',\n            parent=styles['Heading2'],\n            fontName=bold_font\n        )\n        elements.append(Paragraph(\"<b>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º</b>\", heading_style))\n        elements.append(Spacer(1, 0.2*inch))\n        \n        # –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –∑–∞–¥–∞—á (–æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ 50 –∑–∞–¥–∞—á –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏)\n        task_table_data = [['–†–µ—Å—É—Ä—Å', '–ó–∞–¥–∞—á–∞', '–ù–∞—á–∞–ª–æ', '–ö–æ–Ω–µ—Ü', '–ß–∞—Å—ã']]\n        task_count = 0\n        max_tasks = 50\n        \n        for resource in parser.resources[:10]:  # –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ 10 —Ä–µ—Å—É—Ä—Å–æ–≤\n            resource_name = resource['name']\n            resource_assignments = [a for a in parser.assignments if a['resource_id'] == resource['id']]\n            \n            for assignment in resource_assignments[:5]:  # –î–æ 5 –∑–∞–¥–∞—á –Ω–∞ —Ä–µ—Å—É—Ä—Å\n                if task_count >= max_tasks:\n                    break\n                task = next((t for t in parser.tasks if t['id'] == assignment['task_id']), None)\n                if task:\n                    task_name = task.get('name', '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')[:30]  # –û–±—Ä–µ–∑–∞—Ç—å –¥–ª–∏–Ω–Ω—ã–µ –∏–º–µ–Ω–∞\n                    task_start = task.get('start', '')[:10] if task.get('start') else ''\n                    task_finish = task.get('finish', '')[:10] if task.get('finish') else ''\n                    task_hours = parser._parse_work_hours(assignment['work'])\n                    \n                    task_table_data.append([\n                        resource_name[:20],\n                        task_name,\n                        task_start,\n                        task_finish,\n                        f\"{task_hours:.1f}—á\"\n                    ])\n                    task_count += 1\n            \n            if task_count >= max_tasks:\n                break\n        \n        if len(task_table_data) > 1:\n            task_table = Table(task_table_data, colWidths=[1.2*inch, 2.5*inch, 1*inch, 1*inch, 0.8*inch])\n            task_table.setStyle(TableStyle([\n                ('BACKGROUND', (0, 0), (-1, 0), colors.HexColor('#0078D4')),\n                ('TEXTCOLOR', (0, 0), (-1, 0), colors.whitesmoke),\n                ('ALIGN', (0, 0), (-1, -1), 'LEFT'),\n                ('FONTNAME', (0, 0), (-1, 0), bold_font),\n                ('FONTNAME', (0, 1), (-1, -1), normal_font),\n                ('FONTSIZE', (0, 0), (-1, 0), 10),\n                ('FONTSIZE', (0, 1), (-1, -1), 8),\n                ('BOTTOMPADDING', (0, 0), (-1, 0), 8),\n                ('BACKGROUND', (0, 1), (-1, -1), colors.beige),\n                ('GRID', (0, 0), (-1, -1), 0.5, colors.grey)\n            ]))\n            elements.append(task_table)\n    \n    # –°–µ–∫—Ü–∏—è: –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –Ω–µ–¥–µ–ª—è–º\n    if timeline_data:\n        elements.append(Spacer(1, 0.5*inch))\n        heading_style = ParagraphStyle(\n            'CustomHeading2',\n            parent=styles['Heading2'],\n            fontName=bold_font\n        )\n        elements.append(Paragraph(\"<b>–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –Ω–µ–¥–µ–ª—è–º</b>\", heading_style))\n        elements.append(Spacer(1, 0.2*inch))\n        \n        # –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –Ω–µ–¥–µ–ª—å (–æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏)\n        week_table_data = [['–†–µ—Å—É—Ä—Å', '–ü–µ—Ä–∏–æ–¥', '–ß–∞—Å—ã', '–Å–º–∫–æ—Å—Ç—å', '–ó–∞–≥—Ä—É–∑–∫–∞ %']]\n        week_count = 0\n        max_weeks = 40\n        \n        for resource_name, weekly_loads in list(timeline_data.items())[:5]:  # –î–æ 5 —Ä–µ—Å—É—Ä—Å–æ–≤\n            for week_data in weekly_loads[:8]:  # –î–æ 8 –Ω–µ–¥–µ–ª—å –Ω–∞ —Ä–µ—Å—É—Ä—Å\n                if week_count >= max_weeks:\n                    break\n                week_label = week_data['week']\n                hours = week_data['hours']\n                capacity = week_data['capacity']\n                percentage = week_data['percentage']\n                \n                week_table_data.append([\n                    resource_name[:20],\n                    week_label,\n                    f\"{hours:.1f}—á\",\n                    f\"{capacity:.1f}—á\",\n                    f\"{percentage:.1f}%\"\n                ])\n                week_count += 1\n            \n            if week_count >= max_weeks:\n                break\n        \n        if len(week_table_data) > 1:\n            week_table = Table(week_table_data, colWidths=[1.5*inch, 1.5*inch, 1*inch, 1*inch, 1*inch])\n            week_table.setStyle(TableStyle([\n                ('BACKGROUND', (0, 0), (-1, 0), colors.HexColor('#0078D4')),\n                ('TEXTCOLOR', (0, 0), (-1, 0), colors.whitesmoke),\n                ('ALIGN', (0, 0), (-1, -1), 'LEFT'),\n                ('FONTNAME', (0, 0), (-1, 0), bold_font),\n                ('FONTNAME', (0, 1), (-1, -1), normal_font),\n                ('FONTSIZE', (0, 0), (-1, 0), 10),\n                ('FONTSIZE', (0, 1), (-1, -1), 8),\n                ('BOTTOMPADDING', (0, 0), (-1, 0), 8),\n                ('BACKGROUND', (0, 1), (-1, -1), colors.beige),\n                ('GRID', (0, 0), (-1, -1), 0.5, colors.grey)\n            ]))\n            elements.append(week_table)\n    \n    # –°–µ–∫—Ü–∏—è: –î–µ—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏\n    if optimization_results:\n        elements.append(Spacer(1, 0.5*inch))\n        heading_style = ParagraphStyle(\n            'CustomHeading2',\n            parent=styles['Heading2'],\n            fontName=bold_font\n        )\n        elements.append(Paragraph(\"<b>–î–µ—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</b>\", heading_style))\n        elements.append(Spacer(1, 0.2*inch))\n        \n        # –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏\n        opt_table_data = [['–†–µ—Å—É—Ä—Å', '–ó–∞–¥–∞—á–∞', '–°–º–µ—â–µ–Ω–∏–µ', '–£–ª—É—á—à–µ–Ω–∏–µ', '–ü—Ä–∏—á–∏–Ω–∞']]\n        \n        for i, suggestion in enumerate(optimization_results[:20]):  # –î–æ 20 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π\n            resource = suggestion.get('resource', '')[:15]\n            task_name = suggestion.get('task_name', '')[:20]\n            shift_info = f\"{suggestion.get('shift_days', '')} –¥–Ω.\"\n            improvement = suggestion.get('improvement', '')\n            reason = suggestion.get('reason', '')[:40]\n            \n            opt_table_data.append([\n                resource,\n                task_name,\n                shift_info,\n                improvement,\n                reason\n            ])\n        \n        if len(opt_table_data) > 1:\n            opt_table = Table(opt_table_data, colWidths=[1*inch, 1.5*inch, 0.8*inch, 0.8*inch, 2.4*inch])\n            opt_table.setStyle(TableStyle([\n                ('BACKGROUND', (0, 0), (-1, 0), colors.HexColor('#0078D4')),\n                ('TEXTCOLOR', (0, 0), (-1, 0), colors.whitesmoke),\n                ('ALIGN', (0, 0), (-1, -1), 'LEFT'),\n                ('FONTNAME', (0, 0), (-1, 0), bold_font),\n                ('FONTNAME', (0, 1), (-1, -1), normal_font),\n                ('FONTSIZE', (0, 0), (-1, 0), 10),\n                ('FONTSIZE', (0, 1), (-1, -1), 7),\n                ('BOTTOMPADDING', (0, 0), (-1, 0), 8),\n                ('BACKGROUND', (0, 1), (-1, -1), colors.beige),\n                ('GRID', (0, 0), (-1, -1), 0.5, colors.grey)\n            ]))\n            elements.append(opt_table)\n    \n    doc.build(elements)\n    buffer.seek(0)\n    return buffer\n\ndef calculate_business_days(start_date, end_date):\n    \"\"\"–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π –º–µ–∂–¥—É –¥–≤—É–º—è –¥–∞—Ç–∞–º–∏ (–∏—Å–∫–ª—é—á–∞—è —Å—É–±–±–æ—Ç—É –∏ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)\"\"\"\n    if not start_date or not end_date:\n        return 0\n    \n    business_days = 0\n    current_date = start_date\n    \n    while current_date <= end_date:\n        # weekday(): 0=Monday, 1=Tuesday, ..., 6=Sunday\n        if current_date.weekday() < 5:  # 0-4 —ç—Ç–æ –ø–Ω-–ø—Ç\n            business_days += 1\n        current_date += timedelta(days=1)\n    \n    return business_days\n\ndef calculate_work_capacity(business_days):\n    \"\"\"–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞–±–æ—á—É—é –µ–º–∫–æ—Å—Ç—å –æ–¥–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –≤ —á–∞—Å–∞—Ö (–¥–Ω–∏ √ó 8 —á–∞—Å–æ–≤)\"\"\"\n    return business_days * 8\n\ndef calculate_actual_hours_per_resource(parser, date_start, date_end):\n    \"\"\"–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥\"\"\"\n    if not parser:\n        return {}\n    \n    resource_hours = {}\n    \n    # –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏ –∏–∑ parser\n    for task in parser.tasks:\n        task_start_raw = task.get('start')\n        task_end_raw = task.get('finish')\n        \n        if not task_start_raw or not task_end_raw:\n            continue\n        \n        # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ date –µ—Å–ª–∏ —ç—Ç–æ datetime\n        if isinstance(task_start_raw, str):\n            try:\n                task_start = datetime.fromisoformat(task_start_raw).date()\n            except:\n                continue\n        elif isinstance(task_start_raw, datetime):\n            task_start = task_start_raw.date()\n        else:\n            task_start = task_start_raw\n            \n        if isinstance(task_end_raw, str):\n            try:\n                task_end = datetime.fromisoformat(task_end_raw).date()\n            except:\n                continue\n        elif isinstance(task_end_raw, datetime):\n            task_end = task_end_raw.date()\n        else:\n            task_end = task_end_raw\n        \n        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º\n        if task_end < date_start or task_start > date_end:\n            continue\n        \n        # –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤\n        overlap_start = max(task_start, date_start)\n        overlap_end = min(task_end, date_end)\n        \n        # –ù–∞–π—Ç–∏ –≤—Å–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏\n        task_assignments = [a for a in parser.assignments if a['task_id'] == task['id']]\n        \n        for assignment in task_assignments:\n            resource_id = assignment.get('resource_id')\n            if not resource_id:\n                continue\n                \n            # –ù–∞–π—Ç–∏ –∏–º—è —Ä–µ—Å—É—Ä—Å–∞\n            resource = next((r for r in parser.resources if r['id'] == resource_id), None)\n            if not resource:\n                continue\n                \n            resource_name = resource['name']\n            work_hours = parser._parse_work_hours(assignment.get('work', '0'))\n            \n            # –ü—Ä–æ–ø–æ—Ä—Ü–∏—è –∑–∞–¥–∞—á–∏ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ\n            task_duration_days = (task_end - task_start).days + 1\n            overlap_duration_days = (overlap_end - overlap_start).days + 1\n            \n            if task_duration_days > 0:\n                proportion = overlap_duration_days / task_duration_days\n                hours_in_range = work_hours * proportion\n            else:\n                hours_in_range = work_hours\n            \n            # –°—É–º–º–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—ã –¥–ª—è —Ä–µ—Å—É—Ä—Å–∞\n            if resource_name not in resource_hours:\n                resource_hours[resource_name] = 0\n            resource_hours[resource_name] += hours_in_range\n    \n    return resource_hours\n\n# Initialize session state\nif 'workload_data' not in st.session_state:\n    st.session_state.workload_data = None\nif 'analysis' not in st.session_state:\n    st.session_state.analysis = None\nif 'parser' not in st.session_state:\n    st.session_state.parser = None\nif 'optimization_results' not in st.session_state:\n    st.session_state.optimization_results = None\nif 'timeline_data' not in st.session_state:\n    st.session_state.timeline_data = None\nif 'resource_replacements' not in st.session_state:\n    st.session_state.resource_replacements = {}\nif 'date_range_start' not in st.session_state:\n    st.session_state.date_range_start = None\nif 'date_range_end' not in st.session_state:\n    st.session_state.date_range_end = None\nif 'resource_groups' not in st.session_state:\n    st.session_state.resource_groups = {}\nif 'display_mode' not in st.session_state:\n    st.session_state.display_mode = 'percentage'  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–æ—Ü–µ–Ω—Ç—ã\n\n# Main application\ndef main():\n    # –ó–∞–≥–æ–ª–æ–≤–æ–∫\n    st.markdown(\"\"\"\n        <h1 style='color: #0078D4; margin-bottom: 10px;'>üìä –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏</h1>\n        <p style='color: #323130; font-size: 16px; margin-bottom: 30px;'>\n            –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã Microsoft Project –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ —Ä–∞–±–æ—á–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤\n        </p>\n    \"\"\", unsafe_allow_html=True)\n    \n    # –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å\n    with st.sidebar:\n        # –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏\n        st.markdown(\"###  –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏\")\n        display_options = {\n            'percentage': '–í –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö',\n            'hours': '–í —á–∞—Å–∞—Ö'\n        }\n        \n        selected_display = st.radio(\n            \"–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç:\",\n            options=list(display_options.keys()),\n            format_func=lambda x: display_options[x],\n            key='display_selector',\n            label_visibility='collapsed'\n        )\n        \n        # –ï—Å–ª–∏ —Ä–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–∏–ª—Å—è, –æ–±–Ω–æ–≤–ª—è–µ–º session_state –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º\n        if selected_display != st.session_state.display_mode:\n            st.session_state.display_mode = selected_display\n            st.rerun()\n        \n        st.markdown(\"---\")\n        \n        st.markdown(\"### üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ MS Project\")\n        st.markdown(\"–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: .xml, .mspdi\")\n        st.info(\"üí° –ß—Ç–æ–±—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å .mpp –≤ XML: –≤ MS Project –≤—ã–±–µ—Ä–∏—Ç–µ –§–∞–π–ª ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –§–æ—Ä–º–∞—Ç XML (*.xml)\")\n        \n        uploaded_file = st.file_uploader(\n            \"–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª\",\n            type=['xml', 'mspdi'],\n            help=\"–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∞—à XML-—Ñ–∞–π–ª Microsoft Project\"\n        )\n        \n        # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –∫–∞–∫ –±–∞–π—Ç—ã –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏ st.rerun()\n        if uploaded_file is not None:\n            st.session_state.uploaded_file_content = uploaded_file.getvalue()\n            st.session_state.uploaded_file_name = uploaded_file.name\n        \n        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞\n        has_file = (uploaded_file is not None) or ('uploaded_file_content' in st.session_state)\n        \n        if has_file:\n            file_name = uploaded_file.name if uploaded_file is not None else st.session_state.get('uploaded_file_name', '—Ñ–∞–π–ª')\n            st.success(f\"‚úì {file_name} –∑–∞–≥—Ä—É–∂–µ–Ω\")\n            \n            if st.button(\"üîÑ –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª\", use_container_width=True):\n                with st.spinner(\"–ê–Ω–∞–ª–∏–∑ —Ñ–∞–π–ª–∞ MS Project...\"):\n                    # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–ª–∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª\n                    if uploaded_file is not None:\n                        file_content = uploaded_file.getvalue()\n                    else:\n                        file_content = st.session_state.uploaded_file_content\n                    \n                    parser = MSProjectParser(file_content)\n                    \n                    if parser.parse():\n                        st.session_state.parser = parser\n                        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã\n                        today = datetime.now().date()\n                        \n                        # –ü–æ–ª—É—á–∏—Ç—å –¥–∞—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è\n                        project_start, project_end = parser.get_project_dates()\n                        \n                        # –ù–∞—á–∞–ª–æ: —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞ - 7 –¥–Ω–µ–π, –æ–∫—Ä—É–≥–ª–µ–Ω–Ω–∞—è –¥–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞\n                        start_candidate = today - timedelta(days=7)\n                        days_since_monday = start_candidate.weekday()\n                        default_start = start_candidate - timedelta(days=days_since_monday)\n                        \n                        # –ö–æ–Ω–µ—Ü: —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞ + 14 –¥–Ω–µ–π, –æ–∫—Ä—É–≥–ª–µ–Ω–Ω–∞—è –¥–æ –ø—è—Ç–Ω–∏—Ü—ã\n                        end_candidate = today + timedelta(days=14)\n                        days_until_friday = (4 - end_candidate.weekday()) % 7\n                        default_end = end_candidate + timedelta(days=days_until_friday)\n                        \n                        # –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–∞—Ç—ã –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞\n                        if project_start and project_end:\n                            project_start_date = project_start.date()\n                            project_end_date = project_end.date()\n                            default_start = max(default_start, project_start_date)\n                            default_start = min(default_start, project_end_date)\n                            default_end = max(default_end, project_start_date)\n                            default_end = min(default_end, project_end_date)\n                        \n                        st.session_state.date_range_start = default_start\n                        st.session_state.date_range_end = default_end\n                        # –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å —É—á–µ—Ç–æ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞\n                        st.session_state.workload_data = parser.get_resource_workload_data(\n                            st.session_state.date_range_start,\n                            st.session_state.date_range_end\n                        )\n                        st.session_state.analysis = analyze_workload(st.session_state.workload_data)\n                        st.success(\"‚úì –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!\")\n                        st.rerun()\n                    else:\n                        st.error(\"–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª\")\n        \n        # –§–∏–ª—å—Ç—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞\n        if st.session_state.parser is not None:\n            st.markdown(\"---\")\n            st.markdown(\"### üìÖ –í—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω –∞–Ω–∞–ª–∏–∑–∞\")\n            \n            # –ü–æ–ª—É—á–∏—Ç—å –¥–∞—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞\n            project_start, project_end = st.session_state.parser.get_project_dates()\n            \n            if project_start and project_end:\n                col1, col2 = st.columns(2)\n                with col1:\n                    start_date = st.date_input(\n                        \"–ù–∞—á–∞–ª–æ\",\n                        value=st.session_state.date_range_start or project_start.date(),\n                        min_value=project_start.date(),\n                        max_value=project_end.date(),\n                        help=\"–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞\"\n                    )\n                with col2:\n                    end_date = st.date_input(\n                        \"–ö–æ–Ω–µ—Ü\",\n                        value=st.session_state.date_range_end or project_end.date(),\n                        min_value=project_start.date(),\n                        max_value=project_end.date(),\n                        help=\"–ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞\"\n                    )\n                \n                # –û–±–Ω–æ–≤–∏—Ç—å session state –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å\n                if start_date != st.session_state.date_range_start or end_date != st.session_state.date_range_end:\n                    st.session_state.date_range_start = start_date\n                    st.session_state.date_range_end = end_date\n                    # –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å —É—á–µ—Ç–æ–º –Ω–æ–≤–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞\n                    if st.session_state.parser:\n                        st.session_state.workload_data = st.session_state.parser.get_resource_workload_data(\n                            st.session_state.date_range_start,\n                            st.session_state.date_range_end\n                        )\n                        st.session_state.analysis = analyze_workload(st.session_state.workload_data)\n                        # –°–±—Ä–æ—Å–∏—Ç—å timeline_data –∏ optimization_results –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞\n                        st.session_state.timeline_data = None\n                        st.session_state.optimization_results = None\n                    st.rerun()\n        \n        st.markdown(\"---\")\n        st.markdown(\"### ‚ÑπÔ∏è –û –ø—Ä–æ–≥—Ä–∞–º–º–µ\")\n        st.markdown(\"\"\"\n        –≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–º–æ–≥–∞–µ—Ç:\n        - –í—ã—è–≤–∏—Ç—å –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã (>100%)\n        - –ù–∞–π—Ç–∏ –Ω–µ–¥–æ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –º–æ—â–Ω–æ—Å—Ç–∏ (<70%)\n        - **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–º–µ—â–µ–Ω–∏–µ–º –∑–∞–¥–∞—á**\n        - **–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –ø–æ –Ω–µ–¥–µ–ª—è–º**\n        - **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ –∑–∞–º–µ–Ω—è—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤**\n        - –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–µ –Ω–∞–≥—Ä—É–∑–∫–∏\n        - –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç—ã –∞–Ω–∞–ª–∏–∑–∞\n        \"\"\")\n    \n    # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç\n    if st.session_state.workload_data is None:\n        # –≠–∫—Ä–∞–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è\n        st.info(\"üëÜ –ó–∞–≥—Ä—É–∑–∏—Ç–µ XML-—Ñ–∞–π–ª Microsoft Project –¥–ª—è –Ω–∞—á–∞–ª–∞ –∞–Ω–∞–ª–∏–∑–∞\")\n        \n        col1, col2, col3 = st.columns(3)\n        \n        with col1:\n            st.markdown(\"\"\"\n                <div class='metric-card'>\n                    <h3 style='color: #FF4B4B;'>–í—ã—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏</h3>\n                    <p>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ —Å –Ω–∞–≥—Ä—É–∑–∫–æ–π –±–æ–ª–µ–µ 100%</p>\n                </div>\n            \"\"\", unsafe_allow_html=True)\n        \n        with col2:\n            st.markdown(\"\"\"\n                <div class='metric-card'>\n                    <h3 style='color: #107C10;'>–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è</h3>\n                    <p>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤</p>\n                </div>\n            \"\"\", unsafe_allow_html=True)\n        \n        with col3:\n            st.markdown(\"\"\"\n                <div class='metric-card'>\n                    <h3 style='color: #0078D4;'>–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á—ë—Ç–æ–≤</h3>\n                    <p>–°–∫–∞—á–∞–π—Ç–µ –∞–Ω–∞–ª–∏–∑ –≤ —Ñ–æ—Ä–º–∞—Ç–µ CSV –∏–ª–∏ PDF</p>\n                </div>\n            \"\"\", unsafe_allow_html=True)\n        \n        st.markdown(\"### üìã –ü—Ä–∏–º–µ—Ä –∞–Ω–∞–ª–∏–∑–∞\")\n        st.markdown(\"–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–µ—Å—É—Ä—Å–æ–≤ —Å:\")\n        st.markdown(\"- –¶–≤–µ—Ç–Ω—ã–º–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏ —Ä–∞–±–æ—á–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏\")\n        st.markdown(\"- –ù–∞–∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∑–∞–¥–∞—á –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º\")\n        st.markdown(\"- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–º–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏\")\n        st.markdown(\"- –°–≤–æ–¥–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π\")\n        \n    else:\n        # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞\n        workload_data = st.session_state.workload_data\n        analysis = st.session_state.analysis\n        \n        # –°–≤–æ–¥–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏\n        st.markdown(\"### üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è\")\n        \n        # –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞\n        project_weeks = workload_data[0]['project_weeks'] if workload_data else 4\n        \n        col1, col2, col3, col4, col5 = st.columns(5)\n        \n        with col1:\n            st.metric(\"–í—Å–µ–≥–æ —Ä–µ—Å—É—Ä—Å–æ–≤\", len(workload_data))\n        \n        with col2:\n            st.metric(\"–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞\", f\"{project_weeks:.1f} –Ω–µ–¥.\")\n        \n        with col3:\n            st.metric(\"–ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–æ\", len(analysis['overloaded']), \n                     delta=f\"{len(analysis['overloaded'])}\" if len(analysis['overloaded']) > 0 else None,\n                     delta_color=\"inverse\")\n        \n        with col4:\n            st.metric(\"–û–ø—Ç–∏–º–∞–ª—å–Ω–æ\", len(analysis['optimal']),\n                     delta_color=\"off\")\n        \n        with col5:\n            st.metric(\"–ù–µ–¥–æ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è\", len(analysis['underutilized']),\n                     delta=f\"{len(analysis['underutilized'])}\" if len(analysis['underutilized']) > 0 else None,\n                     delta_color=\"normal\")\n        \n        # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–µ—Ä–∏–æ–¥–µ –∞–Ω–∞–ª–∏–∑–∞\n        if st.session_state.date_range_start and st.session_state.date_range_end:\n            business_days = calculate_business_days(st.session_state.date_range_start, st.session_state.date_range_end)\n            work_capacity = calculate_work_capacity(business_days)\n            \n            # Material Design 3 –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–∏–æ–¥–æ–º\n            period_str = f\"{st.session_state.date_range_start.strftime('%d.%m.%Y')} - {st.session_state.date_range_end.strftime('%d.%m.%Y')}\"\n            st.markdown(md3_info_panel(period_str, business_days, work_capacity), unsafe_allow_html=True)\n        \n        st.markdown(\"---\")\n        \n        # –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–∞—è —Å–µ–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º\n        st.markdown(\"### üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º\")\n        \n        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è applied_group –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\n        if not hasattr(st.session_state, 'applied_group'):\n            st.session_state.applied_group = None\n        \n        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–Ω–µ —Ç–∞–±–æ–≤\n        selected_resources = []\n        display_data = workload_data\n        \n        # –î–≤–∞ —Ç–∞–±–∞: –¢–µ–∫—É—â–∏–π –≤—ã–±–æ—Ä –∏ –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã\n        tab1, tab2 = st.tabs([\"üîç –¢–µ–∫—É—â–∏–π –≤—ã–±–æ—Ä\", \"üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã\"])\n        \n        # ========== –¢–ê–ë 1: –¢–ï–ö–£–©–ò–ô –í–´–ë–û–† ==========\n        with tab1:\n            all_names = [item['resource_name'] for item in workload_data]\n            \n            # –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏\n            col1, col2 = st.columns([3, 1])\n            with col1:\n                search_term = st.text_input(\"–ü–æ–∏—Å–∫ –ø–æ —Ñ–∞–º–∏–ª–∏–∏ –∏–ª–∏ –∏–º–µ–Ω–∏:\", placeholder=\"–Ω–∞–ø—Ä–∏–º–µ—Ä, –ò–≤–∞–Ω–æ–≤\")\n            with col2:\n                st.markdown(\"<br>\", unsafe_allow_html=True)\n                show_all = st.checkbox(\"–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö\", value=True)\n            \n            # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø–æ–∏—Å–∫—É\n            if show_all or not search_term:\n                filtered_data = workload_data\n            else:\n                filtered_data = [item for item in workload_data \n                               if search_term.lower() in item['resource_name'].lower()]\n            \n            if not filtered_data:\n                st.warning(\"–†–µ—Å—É—Ä—Å—ã, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É, –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.\")\n                selected_resources = []\n                display_data = []\n            else:\n                # –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å default –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è multiselect\n                if st.session_state.applied_group:\n                    # –ì—Ä—É–ø–ø–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã –∏–∑ –≥—Ä—É–ø–ø—ã –∫–∞–∫ default (–Ω–æ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å options)\n                    group_name, group_resources = st.session_state.applied_group\n                    st.info(f\"üìå –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –≥—Ä—É–ø–ø–∞ '{group_name}' ({len(group_resources)} —á–µ–ª.). –í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–∏–∂–µ.\")\n                    # Default - —Ç–æ–ª—å–∫–æ —Ä–µ—Å—É—Ä—Å—ã –∏–∑ –≥—Ä—É–ø–ø—ã, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –≤ filtered_data\n                    default_resources = [name for name in group_resources \n                                       if name in [item['resource_name'] for item in filtered_data]]\n                else:\n                    # –ì—Ä—É–ø–ø–∞ –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞: –≤—ã–±—Ä–∞—Ç—å –≤—Å–µ—Ö –∏–∑ filtered_data\n                    default_resources = [item['resource_name'] for item in filtered_data]\n                \n                # –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä - options –≤—Å–µ–≥–¥–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç –í–°–ï —Ä–µ—Å—É—Ä—Å—ã –∏–∑ filtered_data\n                selected_resources = st.multiselect(\n                    \"–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:\",\n                    options=[item['resource_name'] for item in filtered_data],\n                    default=default_resources,\n                    key=\"current_selection_multiselect\"\n                )\n                \n                # –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ë—ã—Å—Ç—Ä–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤—ã–±–æ—Ä–∞ –∫–∞–∫ –≥—Ä—É–ø–ø—ã\n                if selected_resources and len(selected_resources) > 0:\n                    st.markdown(\"---\")\n                    with st.expander(\"üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π –≤—ã–±–æ—Ä –∫–∞–∫ –≥—Ä—É–ø–ø—É\"):\n                        quick_group_name = st.text_input(\n                            \"–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≥—Ä—É–ø–ø—ã:\",\n                            placeholder=\"–Ω–∞–ø—Ä–∏–º–µ—Ä, –ö–æ–º–∞–Ω–¥–∞ –ê\",\n                            key=\"quick_save_group_name\"\n                        )\n                        if st.button(\"üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å\", key=\"quick_save_btn\"):\n                            if not quick_group_name:\n                                st.error(\"–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã\")\n                            elif quick_group_name in st.session_state.resource_groups:\n                                st.error(\"–ì—Ä—É–ø–ø–∞ —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç\")\n                            else:\n                                st.session_state.resource_groups[quick_group_name] = selected_resources.copy()\n                                st.success(f\"‚úì –ì—Ä—É–ø–ø–∞ '{quick_group_name}' —Å–æ–∑–¥–∞–Ω–∞ ({len(selected_resources)} —á–µ–ª.)\")\n                                st.rerun()\n                \n                if selected_resources:\n                    display_data = [item for item in filtered_data \n                                  if item['resource_name'] in selected_resources]\n                else:\n                    display_data = filtered_data\n        \n        # ========== –¢–ê–ë 2: –°–û–•–†–ê–ù–ï–ù–ù–´–ï –ì–†–£–ü–ü–´ ==========\n        with tab2:\n            # –í—ã–±–æ—Ä –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –≥—Ä—É–ø–ø—ã\n            if st.session_state.resource_groups:\n                st.markdown(\"**–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –≥—Ä—É–ø–ø—É:**\")\n                group_names = [\"-- –ù–µ –≤—ã–±—Ä–∞–Ω–æ --\"] + list(st.session_state.resource_groups.keys())\n                selected_group = st.selectbox(\n                    \"–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É:\",\n                    options=group_names,\n                    key=\"selected_group_dropdown\"\n                )\n                \n                # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≥—Ä—É–ø–ø—ã\n                if selected_group != \"-- –ù–µ –≤—ã–±—Ä–∞–Ω–æ --\":\n                    group_resources = st.session_state.resource_groups[selected_group]\n                    st.caption(f\"üë• {len(group_resources)} —á–µ–ª–æ–≤–µ–∫: {', '.join(group_resources[:3])}{'...' if len(group_resources) > 3 else ''}\")\n                    \n                    if st.button(\"‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≥—Ä—É–ø–ø—É\", key=\"apply_group_btn\"):\n                        st.session_state.applied_group = (selected_group, group_resources)\n                        st.success(f\"‚úì –ì—Ä—É–ø–ø–∞ '{selected_group}' –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ ({len(group_resources)} —á–µ–ª.)\")\n                        st.rerun()\n                \n                st.markdown(\"---\")\n            else:\n                st.info(\"–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –Ω–∏–∂–µ.\")\n            \n            # –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≥—Ä—É–ø–ø—ã —Å –Ω—É–ª—è\n            st.markdown(\"**–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É:**\")\n            with st.expander(\"‚ûï –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É\", expanded=not st.session_state.resource_groups):\n                new_group_name = st.text_input(\"–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã:\", placeholder=\"–Ω–∞–ø—Ä–∏–º–µ—Ä, –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏\", key=\"new_group_name_input\")\n                \n                all_names = [item['resource_name'] for item in workload_data]\n                new_group_resources = st.multiselect(\n                    \"–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥—Ä—É–ø–ø—ã:\",\n                    options=all_names,\n                    key=\"new_group_resources\"\n                )\n                \n                if st.button(\"üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥—Ä—É–ø–ø—É\", key=\"save_new_group_btn\"):\n                    if not new_group_name:\n                        st.error(\"–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã\")\n                    elif not new_group_resources:\n                        st.error(\"–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞\")\n                    elif new_group_name in st.session_state.resource_groups:\n                        st.error(\"–ì—Ä—É–ø–ø–∞ —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç\")\n                    else:\n                        st.session_state.resource_groups[new_group_name] = new_group_resources\n                        st.success(f\"‚úì –ì—Ä—É–ø–ø–∞ '{new_group_name}' —Å–æ–∑–¥–∞–Ω–∞ ({len(new_group_resources)} —á–µ–ª.)\")\n                        st.rerun()\n            \n            # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –≥—Ä—É–ø–ø–∞–º–∏\n            if st.session_state.resource_groups:\n                st.markdown(\"---\")\n                st.markdown(\"**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏:**\")\n                for group_name in list(st.session_state.resource_groups.keys()):\n                    group_members = st.session_state.resource_groups[group_name]\n                    \n                    # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä—É–ø–ø—ã —Å –∫–Ω–æ–ø–∫–æ–π —É–¥–∞–ª–µ–Ω–∏—è\n                    col1, col2 = st.columns([4, 1])\n                    with col1:\n                        st.markdown(f\"**{group_name}** ({len(group_members)} —á–µ–ª.)\")\n                    with col2:\n                        if st.button(\"üóëÔ∏è\", key=f\"delete_{group_name}\", help=f\"–£–¥–∞–ª–∏—Ç—å –≥—Ä—É–ø–ø—É '{group_name}'\"):\n                            del st.session_state.resource_groups[group_name]\n                            if st.session_state.applied_group and st.session_state.applied_group[0] == group_name:\n                                st.session_state.applied_group = None\n                            st.success(f\"‚úì –ì—Ä—É–ø–ø–∞ '{group_name}' —É–¥–∞–ª–µ–Ω–∞\")\n                            st.rerun()\n                    \n                    # Expander —Å –ø–æ–ª–Ω—ã–º —Å–æ—Å—Ç–∞–≤–æ–º –≥—Ä—É–ø–ø—ã\n                    with st.expander(f\"üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ—Å—Ç–∞–≤–∞ –≥—Ä—É–ø–ø—ã '{group_name}'\"):\n                        if len(group_members) > 0:\n                            # –í—ã–≤–µ—Å—Ç–∏ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ –≤–∏–¥–µ –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞\n                            for idx, member in enumerate(group_members, 1):\n                                st.text(f\"{idx}. {member}\")\n                        else:\n                            st.caption(\"–ì—Ä—É–ø–ø–∞ –ø—É—Å—Ç–∞\")\n                    \n                    st.markdown(\"\")  # –î–æ–±–∞–≤–∏—Ç—å –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –≥—Ä—É–ø–ø–∞–º–∏\n        \n        st.markdown(\"---\")\n        \n        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n        if not selected_resources and not display_data:\n            st.info(\"–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤ —Ç–∞–±–µ '–¢–µ–∫—É—â–∏–π –≤—ã–±–æ—Ä'\")\n        else:\n            # –¢–∞–±–ª–∏—Ü–∞ –∞–Ω–∞–ª–∏–∑–∞ —Ä–∞–±–æ—á–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏\n            st.markdown(\"### üìà –ê–Ω–∞–ª–∏–∑ —Ä–∞–±–æ—á–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏\")\n            \n            # –ü—Ä–∏–º–µ–Ω–∏—Ç—å MD3 —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü\n            st.markdown(get_md3_table_style(), unsafe_allow_html=True)\n            \n            # –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —á–∞—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥\n            actual_hours_dict = {}\n            if st.session_state.parser and st.session_state.date_range_start and st.session_state.date_range_end:\n                actual_hours_dict = calculate_actual_hours_per_resource(\n                    st.session_state.parser,\n                    st.session_state.date_range_start,\n                    st.session_state.date_range_end\n                )\n            \n            # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞\n            df_data = []\n            for item in display_data:\n                percentage = item['workload_percentage']\n                resource_name = item['resource_name']\n                capacity = item['max_capacity']\n                \n                # –ü–æ–ª—É—á–∏—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —á–∞—Å—ã –∑–∞ –ø–µ—Ä–∏–æ–¥\n                actual_hours = actual_hours_dict.get(resource_name, 0.0)\n                \n                # –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –≤ —á–∞—Å–∞—Ö\n                workload_hours = (capacity * percentage / 100) if capacity > 0 else 0\n                \n                # –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞\n                if percentage > 100:\n                    status = \"üî¥ –ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω\"\n                    status_color = \"#FF4B4B\"\n                elif percentage >= 70:\n                    status = \"üü¢ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ\"\n                    status_color = \"#107C10\"\n                else:\n                    status = \"üü° –ù–µ–¥–æ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è\"\n                    status_color = \"#FFB900\"\n                \n                # –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n                row_data = {\n                    '–ò–º—è —Ä–µ—Å—É—Ä—Å–∞': resource_name,\n                    '–í—ã–¥–µ–ª–µ–Ω–æ —á–∞—Å–æ–≤': item['total_work_hours'],\n                    '–Å–º–∫–æ—Å—Ç—å —á–∞—Å–æ–≤': capacity,\n                    '–†–∞–±–æ—á–∏–µ —á–∞—Å—ã –∑–∞ –ø–µ—Ä–∏–æ–¥': actual_hours\n                }\n                \n                # –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–æ–Ω–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞\n                if st.session_state.display_mode == 'hours':\n                    row_data['–ó–∞–≥—Ä—É–∑–∫–∞ (—á–∞—Å—ã)'] = workload_hours\n                else:\n                    row_data['–ù–∞–≥—Ä—É–∑–∫–∞ %'] = percentage\n                \n                row_data['–ö–æ–ª-–≤–æ –∑–∞–¥–∞—á'] = item['task_count']\n                row_data['–°—Ç–∞—Ç—É—Å'] = status\n                \n                df_data.append(row_data)\n            \n            df = pd.DataFrame(df_data)\n            \n            # –†–∞—Å–∫—Ä–∞—Å–∫–∞ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞\n            def highlight_workload(row):\n                # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n                if st.session_state.display_mode == 'hours':\n                    # –í —Ä–µ–∂–∏–º–µ —á–∞—Å–æ–≤ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç –∏–∑ —á–∞—Å–æ–≤\n                    capacity = row['–Å–º–∫–æ—Å—Ç—å —á–∞—Å–æ–≤']\n                    if capacity > 0:\n                        pct = (row['–ó–∞–≥—Ä—É–∑–∫–∞ (—á–∞—Å—ã)'] / capacity) * 100\n                    else:\n                        pct = 0\n                else:\n                    pct = row['–ù–∞–≥—Ä—É–∑–∫–∞ %']\n                \n                if pct > 100:\n                    return ['background-color: #FFE5E5'] * len(row)\n                elif pct < 70:\n                    return ['background-color: #FFF4E5'] * len(row)\n                else:\n                    return ['background-color: #E5F5E5'] * len(row)\n            \n            # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞\n            format_dict = {\n                '–í—ã–¥–µ–ª–µ–Ω–æ —á–∞—Å–æ–≤': '{:.1f}',\n                '–Å–º–∫–æ—Å—Ç—å —á–∞—Å–æ–≤': '{:.1f}',\n                '–†–∞–±–æ—á–∏–µ —á–∞—Å—ã –∑–∞ –ø–µ—Ä–∏–æ–¥': '{:.1f}'\n            }\n            \n            if st.session_state.display_mode == 'hours':\n                format_dict['–ó–∞–≥—Ä—É–∑–∫–∞ (—á–∞—Å—ã)'] = '{:.1f}'\n            else:\n                format_dict['–ù–∞–≥—Ä—É–∑–∫–∞ %'] = '{:.1f}%'\n            \n            styled_df = df.style.apply(highlight_workload, axis=1).format(format_dict)\n            \n            st.dataframe(styled_df, use_container_width=True, hide_index=True)\n            \n            # –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á\n            st.markdown(\"### üìã –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á\")\n            \n            for item in display_data:\n                with st.expander(f\"{item['resource_name']} - {item['workload_percentage']:.1f}% –Ω–∞–≥—Ä—É–∑–∫–∞\"):\n                    if item['tasks']:\n                        task_df = pd.DataFrame(item['tasks'])\n                        st.dataframe(task_df, use_container_width=True, hide_index=True)\n                    else:\n                        st.info(\"–ó–∞–¥–∞—á–∏ –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã\")\n            \n            # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\n            st.markdown(\"### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\")\n            \n            # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è analysis –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º\n            if selected_resources:\n                filtered_analysis = {\n                    'overloaded': [r for r in analysis['overloaded'] if r['resource_name'] in selected_resources],\n                    'optimal': [r for r in analysis['optimal'] if r['resource_name'] in selected_resources],\n                    'underutilized': [r for r in analysis['underutilized'] if r['resource_name'] in selected_resources]\n                }\n            else:\n                filtered_analysis = analysis\n            \n            recommendations = generate_recommendations(filtered_analysis)\n            \n            if recommendations:\n                for i, rec in enumerate(recommendations, 1):\n                    priority_color = {\n                        'High': '#FF4B4B',\n                        'Medium': '#FFB900',\n                        'Low': '#107C10'\n                    }.get(rec.get('priority', 'Low'), '#107C10')\n                    \n                    priority_text = {\n                        'High': '–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç',\n                        'Medium': '–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç',\n                        'Low': '–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç'\n                    }.get(rec.get('priority', 'Low'), '–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç')\n                    \n                    if rec['type'] == 'Reassign Tasks':\n                        st.markdown(f\"\"\"\n                        <div style='background-color: white; padding: 15px; border-radius: 8px; \n                                    margin: 10px 0; border-left: 4px solid {priority_color}'>\n                            <b>{i}. –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∑–∞–¥–∞—á–∏</b> \n                            <span style='background-color: {priority_color}; color: white; \n                                         padding: 2px 8px; border-radius: 3px; font-size: 12px; margin-left: 10px'>\n                                {priority_text}\n                            </span><br/>\n                            –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ <b>{rec['hours']:.1f} —á–∞—Å–æ–≤</b> —Ä–∞–±–æ—Ç—ã –æ—Ç \n                            <b>{rec['from']}</b> –∫ <b>{rec['to']}</b>\n                        </div>\n                        \"\"\", unsafe_allow_html=True)\n                    elif rec['type'] == 'Hire Additional Resources':\n                        st.markdown(f\"\"\"\n                        <div style='background-color: white; padding: 15px; border-radius: 8px; \n                                    margin: 10px 0; border-left: 4px solid {priority_color}'>\n                            <b>{i}. –ù–∞–Ω—è—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã</b>\n                            <span style='background-color: {priority_color}; color: white; \n                                         padding: 2px 8px; border-radius: 3px; font-size: 12px; margin-left: 10px'>\n                                {priority_text}\n                            </span><br/>\n                            –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞–π–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ <b>{rec['resource']}</b><br/>\n                            –ü—Ä–∏—á–∏–Ω–∞: {rec['reason']}\n                        </div>\n                        \"\"\", unsafe_allow_html=True)\n                    else:\n                        st.markdown(f\"\"\"\n                        <div style='background-color: white; padding: 15px; border-radius: 8px; \n                                    margin: 10px 0; border-left: 4px solid {priority_color}'>\n                            <b>{i}. –£–≤–µ–ª–∏—á–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</b>\n                            <span style='background-color: {priority_color}; color: white; \n                                         padding: 2px 8px; border-radius: 3px; font-size: 12px; margin-left: 10px'>\n                                {priority_text}\n                            </span><br/>\n                            <b>{rec['resource']}</b> –∏–º–µ–µ—Ç {rec['available_capacity']} –¥–æ—Å—Ç—É–ø–Ω–æ–π –º–æ—â–Ω–æ—Å—Ç–∏\n                        </div>\n                        \"\"\", unsafe_allow_html=True)\n            else:\n                st.success(\"‚úì –í—Å–µ —Ä–µ—Å—É—Ä—Å—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ!\")\n            \n            # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å —Å–º–µ—â–µ–Ω–∏–µ–º –∑–∞–¥–∞—á\n            st.markdown(\"---\")\n            st.markdown(\"## ‚öôÔ∏è –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è\")\n            \n            with st.expander(\"üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏\", expanded=True):\n                col_opt1, col_opt2, col_opt3 = st.columns(3)\n                \n                with col_opt1:\n                    max_shift_days = st.slider(\n                        \"–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –∑–∞–¥–∞—á (–¥–Ω–∏)\",\n                        min_value=1,\n                        max_value=30,\n                        value=14,\n                        help=\"–ù–∞—Å–∫–æ–ª—å–∫–æ –¥–∞–ª–µ–∫–æ –º–æ–∂–Ω–æ —Å–¥–≤–∏–≥–∞—Ç—å –∑–∞–¥–∞—á–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏\"\n                    )\n                \n                with col_opt2:\n                    target_load = st.slider(\n                        \"–¶–µ–ª–µ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (%)\",\n                        min_value=70,\n                        max_value=100,\n                        value=85,\n                        help=\"–ñ–µ–ª–∞–µ–º—ã–π —É—Ä–æ–≤–µ–Ω—å –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤\"\n                    )\n                \n                with col_opt3:\n                    opt_mode = st.selectbox(\n                        \"–†–µ–∂–∏–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏\",\n                        options=['balance', 'minimize_peaks'],\n                        format_func=lambda x: '–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏' if x == 'balance' else '–ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø–∏–∫–æ–≤',\n                        help=\"–°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è\"\n                    )\n                \n                if st.button(\"üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é\", use_container_width=True):\n                    with st.spinner(\"–†–∞—Å—á—ë—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è...\"):\n                        optimization_settings = {\n                            'max_shift_days': max_shift_days,\n                            'target_load': target_load,\n                            'mode': opt_mode\n                        }\n                        st.session_state.optimization_results = optimize_with_task_shifting(\n                            st.session_state.parser, \n                            optimization_settings,\n                            st.session_state.date_range_start,\n                            st.session_state.date_range_end,\n                            selected_resources\n                        )\n                        st.session_state.timeline_data = st.session_state.parser.get_timeline_workload(\n                            st.session_state.date_range_start,\n                            st.session_state.date_range_end\n                        )\n                        st.success(\"‚úì –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\")\n                        st.rerun()\n            \n            # –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏\n            if st.session_state.optimization_results:\n                st.markdown(\"### üìà –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —Å–º–µ—â–µ–Ω–∏—é –∑–∞–¥–∞—á\")\n                \n                opt_results = st.session_state.optimization_results\n                if opt_results:\n                    for i, suggestion in enumerate(opt_results[:10], 1):\n                        priority_color = {\n                            '–í—ã—Å–æ–∫–∏–π': '#FF4B4B',\n                            '–°—Ä–µ–¥–Ω–∏–π': '#FFB900',\n                            '–ù–∏–∑–∫–∏–π': '#107C10'\n                        }.get(suggestion.get('priority', '–ù–∏–∑–∫–∏–π'), '#107C10')\n                        \n                        improvement_info = f\"<b>–£–ª—É—á—à–µ–Ω–∏–µ:</b> {suggestion['improvement']}<br/>\" if 'improvement' in suggestion else \"\"\n                        st.markdown(f\"\"\"\n                        <div style='background-color: white; padding: 15px; border-radius: 8px; \n                                    margin: 10px 0; border-left: 4px solid {priority_color}'>\n                            <b>{i}. –°–¥–≤–∏–Ω—É—Ç—å –∑–∞–¥–∞—á—É \"{suggestion['task_name']}\"</b> \n                            <span style='background-color: {priority_color}; color: white; \n                                         padding: 2px 8px; border-radius: 3px; font-size: 12px; margin-left: 10px'>\n                                {suggestion['priority']}\n                            </span><br/>\n                            <b>–†–µ—Å—É—Ä—Å:</b> {suggestion['resource']}<br/>\n                            <b>–û–±—ä—ë–º —Ä–∞–±–æ—Ç—ã:</b> {suggestion['task_hours']:.1f} —á–∞—Å–æ–≤<br/>\n                            <b>–¢–µ–∫—É—â–∏–µ –¥–∞—Ç—ã:</b> {suggestion['original_start']} ‚Üí {suggestion['original_end']}<br/>\n                            <b>–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–µ –¥–∞—Ç—ã:</b> {suggestion['suggested_start']} ‚Üí {suggestion['suggested_end']} \n                            (—Å–¥–≤–∏–≥ –Ω–∞ {suggestion['shift_days']} –¥–Ω.)<br/>\n                            {improvement_info}\n                            <b>–ü—Ä–∏—á–∏–Ω–∞:</b> {suggestion['reason']}\n                        </div>\n                        \"\"\", unsafe_allow_html=True)\n                else:\n                    st.success(\"‚úì –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ, —Å–º–µ—â–µ–Ω–∏—è –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è!\")\n            \n            # –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤\n            if st.session_state.timeline_data:\n                st.markdown(\"### üìÖ –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø–æ –Ω–µ–¥–µ–ª—è–º\")\n                \n                # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è timeline_data –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º\n                if selected_resources:\n                    timeline_data = {k: v for k, v in st.session_state.timeline_data.items() if k in selected_resources}\n                else:\n                    timeline_data = st.session_state.timeline_data\n                \n                # –í—ã–±–æ—Ä —Ä–µ—Å—É—Ä—Å–∞ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏\n                selected_resource_timeline = st.selectbox(\n                    \"–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ—Å—É—Ä—Å –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞\",\n                    options=list(timeline_data.keys()),\n                    key=\"timeline_resource_select\"\n                )\n                \n                if selected_resource_timeline and selected_resource_timeline in timeline_data:\n                    resource_timeline = timeline_data[selected_resource_timeline]\n                    \n                    # –ü–æ–ª—É—á–∏—Ç—å MD3 —Ü–≤–µ—Ç–∞ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤\n                    chart_colors = get_md3_chart_colors()\n                    color_overloaded = chart_colors['overloaded']\n                    color_optimal = chart_colors['optimal']\n                    color_underutilized = chart_colors['underutilized']\n                    color_primary = chart_colors['optimal']\n                    \n                    # –ì—Ä–∞—Ñ–∏–∫ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏\n                    fig_timeline = go.Figure()\n                    \n                    weeks = [w['week'] for w in resource_timeline]\n                    percentages = [w['percentage'] for w in resource_timeline]\n                    hours = [w['hours'] for w in resource_timeline]\n                    \n                    # –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞\n                    if st.session_state.display_mode == 'hours':\n                        y_values = hours\n                        text_values = [f\"{h:.1f} —á.\" for h in hours]\n                        hover_template = '<b>%{x}</b><br>–ó–∞–≥—Ä—É–∑–∫–∞: %{y:.1f} —á.<br><extra></extra>'\n                        yaxis_title = \"–ó–∞–≥—Ä—É–∑–∫–∞ (—á–∞—Å—ã)\"\n                        \n                        # –ü–æ—Ä–æ–≥–æ–≤—ã–µ –ª–∏–Ω–∏–∏ –≤ —á–∞—Å–∞—Ö (–Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ä–µ–¥–Ω–µ–π –Ω–µ–¥–µ–ª—å–Ω–æ–π —ë–º–∫–æ—Å—Ç–∏)\n                        avg_week_capacity = sum(hours) / len(hours) if hours else 40\n                        threshold_100 = avg_week_capacity\n                        threshold_target = avg_week_capacity * (target_load / 100)\n                        line1_text = f\"{threshold_100:.1f} —á. (100%)\"\n                        line2_text = f\"{threshold_target:.1f} —á. ({target_load}%)\"\n                    else:\n                        y_values = percentages\n                        text_values = [f\"{p:.1f}%\" for p in percentages]\n                        hover_template = '<b>%{x}</b><br>–ó–∞–≥—Ä—É–∑–∫–∞: %{y:.1f}%<br>–ß–∞—Å–æ–≤: %{customdata:.1f} —á.<br><extra></extra>'\n                        yaxis_title = \"–ó–∞–≥—Ä—É–∑–∫–∞ (%)\"\n                        threshold_100 = 100\n                        threshold_target = target_load\n                        line1_text = \"100%\"\n                        line2_text = f\"–¶–µ–ª—å {target_load}%\"\n                    \n                    # –¶–≤–µ—Ç–æ–≤–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞ –ø–æ –Ω–µ–¥–µ–ª—è–º\n                    colors_timeline = []\n                    for pct in percentages:\n                        if pct > 100:\n                            colors_timeline.append(color_overloaded)\n                        elif pct >= 70:\n                            colors_timeline.append(color_optimal)\n                        else:\n                            colors_timeline.append(color_underutilized)\n                    \n                    fig_timeline.add_trace(go.Bar(\n                        x=weeks,\n                        y=y_values,\n                        marker_color=colors_timeline,\n                        text=text_values,\n                        textposition='outside',\n                        customdata=hours,\n                        hovertemplate=hover_template,\n                        name='–ó–∞–≥—Ä—É–∑–∫–∞'\n                    ))\n                    \n                    fig_timeline.add_hline(y=threshold_100, line_dash=\"dash\", line_color=color_overloaded, \n                                          annotation_text=line1_text, annotation_position=\"right\")\n                    fig_timeline.add_hline(y=threshold_target, line_dash=\"dot\", line_color=color_primary, \n                                          annotation_text=line2_text, annotation_position=\"right\")\n                    \n                    fig_timeline.update_layout(\n                        title=f\"–ù–µ–¥–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: {selected_resource_timeline}\",\n                        xaxis_title=\"–ù–µ–¥–µ–ª—è\",\n                        yaxis_title=yaxis_title,\n                        showlegend=False,\n                        height=400,\n                        plot_bgcolor='white',\n                        paper_bgcolor='white',\n                        font=dict(family=\"Segoe UI, Inter, sans-serif\", size=12, color=\"#323130\")\n                    )\n                    \n                    st.plotly_chart(fig_timeline, use_container_width=True)\n            \n            # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∑–∞–º–µ–Ω–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤\n            if filtered_analysis['overloaded']:\n                st.markdown(\"---\")\n                st.markdown(\"### üîÑ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∑–∞–º–µ–Ω–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤\")\n                st.info(\"–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–µ–Ω—É –¥–ª—è –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–π—Ç–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é\")\n                \n                for overloaded_resource in filtered_analysis['overloaded'][:3]:  # –¢–æ–ø-3 –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö\n                    resource_name = overloaded_resource['resource_name']\n                    overload_pct = overloaded_resource['workload_percentage']\n                    \n                    with st.expander(f\"‚ö†Ô∏è {resource_name} ({overload_pct:.1f}% –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞)\"):\n                        st.markdown(f\"**–¢–µ–∫—É—â–∞—è –∑–∞–≥—Ä—É–∑–∫–∞:** {overload_pct:.1f}%\")\n                        st.markdown(f\"**–ò–∑–±—ã—Ç–æ–∫:** {overload_pct - 100:.1f}%\")\n                        \n                        # –í–∞—Ä–∏–∞–Ω—Ç—ã –∑–∞–º–µ–Ω—ã (–Ω–µ–¥–æ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã)\n                        replacement_options = [r['resource_name'] for r in filtered_analysis['underutilized']]\n                        replacement_options.insert(0, \"-- –ù–µ –º–µ–Ω—è—Ç—å --\")\n                        \n                        selected_replacement = st.selectbox(\n                            \"–ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞:\",\n                            options=replacement_options,\n                            key=f\"replacement_{resource_name}\"\n                        )\n                        \n                        if selected_replacement != \"-- –ù–µ –º–µ–Ω—è—Ç—å --\":\n                            if st.button(f\"‚úì –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∑–∞–º–µ–Ω—É {resource_name} ‚Üí {selected_replacement}\", \n                                       key=f\"apply_{resource_name}\"):\n                                st.session_state.resource_replacements[resource_name] = selected_replacement\n                                st.success(f\"‚úì –ó–∞–º–µ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: {resource_name} ‚Üí {selected_replacement}\")\n                                st.info(\"üí° –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –∑–∞–Ω–æ–≤–æ –¥–ª—è –ø–µ—Ä–µ—Å—á—ë—Ç–∞ —Å —É—á—ë—Ç–æ–º –∑–∞–º–µ–Ω—ã\")\n                \n                # –ü–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–º–µ–Ω—ã\n                if st.session_state.resource_replacements:\n                    st.markdown(\"**–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–º–µ–Ω—ã:**\")\n                    for old_res, new_res in st.session_state.resource_replacements.items():\n                        st.markdown(f\"- {old_res} ‚Üí {new_res}\")\n                    \n                    if st.button(\"üîÑ –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å —É—á—ë—Ç–æ–º –∑–∞–º–µ–Ω\", use_container_width=True):\n                        st.info(\"üí° –§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á—ë—Ç —Å —É—á—ë—Ç–æ–º –∑–∞–º–µ–Ω —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤\")\n            \n            # –û–ø—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞\n            st.markdown(\"---\")\n            st.markdown(\"### üì• –≠–∫—Å–ø–æ—Ä—Ç –∞–Ω–∞–ª–∏–∑–∞\")\n            col1, col2 = st.columns(2)\n            \n            with col1:\n                # –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–∏–æ–¥–∞ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞\n                export_date_start = st.session_state.date_range_start\n                export_date_end = st.session_state.date_range_end\n                export_business_days = None\n                export_capacity = None\n                \n                if export_date_start and export_date_end:\n                    export_business_days = calculate_business_days(export_date_start, export_date_end)\n                    export_capacity = calculate_work_capacity(export_business_days)\n                \n                csv_data = export_to_csv(\n                    df, \n                    analysis, \n                    parser=st.session_state.parser,\n                    timeline_data=st.session_state.timeline_data,\n                    optimization_results=st.session_state.optimization_results,\n                    date_start=export_date_start,\n                    date_end=export_date_end,\n                    business_days=export_business_days,\n                    capacity=export_capacity\n                )\n                st.download_button(\n                    label=\"üìÑ –°–∫–∞—á–∞—Ç—å CSV\",\n                    data=csv_data,\n                    file_name=f\"resource_analysis_{datetime.now().strftime('%Y%m%d_%H%M%S')}.csv\",\n                    mime=\"text/csv\",\n                    use_container_width=True\n                )\n            \n            with col2:\n                pdf_data = export_to_pdf(\n                    df, \n                    analysis, \n                    recommendations,\n                    parser=st.session_state.parser,\n                    timeline_data=st.session_state.timeline_data,\n                    optimization_results=st.session_state.optimization_results,\n                    date_start=export_date_start,\n                    date_end=export_date_end,\n                    business_days=export_business_days,\n                    capacity=export_capacity\n                )\n                st.download_button(\n                    label=\"üìë –°–∫–∞—á–∞—Ç—å PDF\",\n                    data=pdf_data,\n                    file_name=f\"resource_analysis_{datetime.now().strftime('%Y%m%d_%H%M%S')}.pdf\",\n                    mime=\"application/pdf\",\n                    use_container_width=True\n                )\n            \n            # –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è\n            st.markdown(\"### üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–±–æ—á–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏\")\n            \n            # –ü–æ–ª—É—á–∏—Ç—å MD3 —Ü–≤–µ—Ç–∞ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤\n            chart_colors = get_md3_chart_colors()\n            color_overloaded = chart_colors['overloaded']\n            color_optimal = chart_colors['optimal']\n            color_underutilized = chart_colors['underutilized']\n            \n            fig = go.Figure()\n            \n            # –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n            if st.session_state.display_mode == 'hours':\n                # –†–µ–∂–∏–º —á–∞—Å–æ–≤\n                y_values = [(item['max_capacity'] * item['workload_percentage'] / 100) for item in display_data]\n                text_values = [f\"{y:.1f} —á.\" for y in y_values]\n                hover_template = '<b>%{x}</b><br>–ó–∞–≥—Ä—É–∑–∫–∞: %{y:.1f} —á.<br><extra></extra>'\n                yaxis_title = \"–ó–∞–≥—Ä—É–∑–∫–∞ (—á–∞—Å—ã)\"\n                \n                # –ü–æ—Ä–æ–≥–æ–≤—ã–µ –ª–∏–Ω–∏–∏ –≤ —á–∞—Å–∞—Ö (—Å—Ä–µ–¥–Ω—è—è —ë–º–∫–æ—Å—Ç—å)\n                avg_capacity = sum([item['max_capacity'] for item in display_data]) / len(display_data) if display_data else 0\n                threshold_100 = avg_capacity\n                threshold_70 = avg_capacity * 0.7\n                line1_text = f\"{threshold_100:.1f} —á. (100%)\"\n                line2_text = f\"{threshold_70:.1f} —á. (70%)\"\n            else:\n                # –†–µ–∂–∏–º –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤\n                y_values = [item['workload_percentage'] for item in display_data]\n                text_values = [f\"{y:.1f}%\" for y in y_values]\n                hover_template = '<b>%{x}</b><br>–ù–∞–≥—Ä—É–∑–∫–∞: %{y:.1f}%<br><extra></extra>'\n                yaxis_title = \"–ü—Ä–æ—Ü–µ–Ω—Ç –Ω–∞–≥—Ä—É–∑–∫–∏ (%)\"\n                threshold_100 = 100\n                threshold_70 = 70\n                line1_text = \"100% —ë–º–∫–æ—Å—Ç—å\"\n                line2_text = \"70% –ø–æ—Ä–æ–≥\"\n            \n            # –¶–≤–µ—Ç–æ–≤–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞\n            colors_map = []\n            for item in display_data:\n                percentage = item['workload_percentage']\n                if percentage > 100:\n                    colors_map.append(color_overloaded)\n                elif percentage >= 70:\n                    colors_map.append(color_optimal)\n                else:\n                    colors_map.append(color_underutilized)\n            \n            fig.add_trace(go.Bar(\n                x=[item['resource_name'] for item in display_data],\n                y=y_values,\n                marker_color=colors_map,\n                text=text_values,\n                textposition='outside',\n                hovertemplate=hover_template\n            ))\n            \n            # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–æ–≤—ã—Ö –ª–∏–Ω–∏–π\n            fig.add_hline(y=threshold_100, line_dash=\"dash\", line_color=color_overloaded, \n                         annotation_text=line1_text, annotation_position=\"right\")\n            fig.add_hline(y=threshold_70, line_dash=\"dash\", line_color=color_underutilized, \n                         annotation_text=line2_text, annotation_position=\"right\")\n            \n            fig.update_layout(\n                title=\"–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—á–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤\",\n                xaxis_title=\"–†–µ—Å—É—Ä—Å\",\n                yaxis_title=yaxis_title,\n                showlegend=False,\n                height=500,\n                plot_bgcolor='white',\n                paper_bgcolor='white',\n                font=dict(family=\"Segoe UI, Inter, sans-serif\", size=12, color=\"#323130\")\n            )\n            \n            fig.update_xaxes(showgrid=False)\n            fig.update_yaxes(showgrid=True, gridcolor='#E5E5E5')\n            \n            st.plotly_chart(fig, use_container_width=True)\n\nif __name__ == \"__main__\":\n    main()\n","size_bytes":119239},"pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"fpdf>=1.7.2\",\n    \"lxml>=6.0.2\",\n    \"openpyxl>=3.1.5\",\n    \"pandas>=2.3.3\",\n    \"plotly>=6.3.1\",\n    \"python-dateutil>=2.9.0.post0\",\n    \"reportlab>=4.4.4\",\n    \"streamlit>=1.51.0\",\n]\n","size_bytes":332},"main.py":{"content":"def main():\n    print(\"Hello from repl-nix-workspace!\")\n\n\nif __name__ == \"__main__\":\n    main()\n","size_bytes":96},"BUILD_INSTRUCTIONS.md":{"content":"# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é .exe —Ñ–∞–π–ª–∞ –¥–ª—è Windows 10\n\n## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è\n\n### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:\n1. **Windows 10** (64-bit —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)\n2. **Python 3.10 –∏–ª–∏ –≤—ã—à–µ** - —Å–∫–∞—á–∞–π—Ç–µ —Å [python.org](https://www.python.org/downloads/)\n   - ‚ö†Ô∏è –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ—Ç–º–µ—Ç—å—Ç–µ **\"Add Python to PATH\"**\n3. **–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** (–¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)\n4. **–ú–∏–Ω–∏–º—É–º 2 –ì–ë —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞** –Ω–∞ –¥–∏—Å–∫–µ\n\n### –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:\n- **4 –ì–ë RAM** –∏–ª–∏ –±–æ–ª—å—à–µ\n- **–ê–Ω—Ç–∏–≤–∏—Ä—É—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω** (PyInstaller –∏–Ω–æ–≥–¥–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–∞–º–∏)\n\n---\n\n## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞)\n\n### –®–∞–≥ 1: –°–∫–∞—á–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç\n–°–∫–∞—á–∞–π—Ç–µ –≤—Å–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –≤ –æ–¥–Ω—É –ø–∞–ø–∫—É –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:\n```\nC:\\MSProjectAnalyzer\\\n  ‚îú‚îÄ‚îÄ app.py\n  ‚îú‚îÄ‚îÄ run_app.py          (launcher –¥–ª—è .exe)\n  ‚îú‚îÄ‚îÄ md3_components.py\n  ‚îú‚îÄ‚îÄ app.spec\n  ‚îú‚îÄ‚îÄ build_exe.bat\n  ‚îú‚îÄ‚îÄ requirements_exe.txt\n  ‚îî‚îÄ‚îÄ .streamlit\\\n      ‚îî‚îÄ‚îÄ config.toml\n```\n\n### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–±–æ—Ä–∫—É\n1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞ –≤ –ü—Ä–æ–≤–æ–¥–Ω–∏–∫–µ\n2. **–î–≤–∞–∂–¥—ã –∫–ª–∏–∫–Ω–∏—Ç–µ** –ø–æ —Ñ–∞–π–ª—É `build_exe.bat`\n3. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (5-15 –º–∏–Ω—É—Ç)\n\n### –®–∞–≥ 3: –ì–æ—Ç–æ–≤–æ!\n–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Å–±–æ—Ä–∫–∏ –≤ –ø–∞–ø–∫–µ –ø–æ—è–≤–∏—Ç—Å—è —Ñ–∞–π–ª:\n```\nMSProjectAnalyzer.exe  (–ø—Ä–∏–º–µ—Ä–Ω–æ 150-300 –ú–ë)\n```\n\n---\n\n## –†—É—á–Ω–∞—è —Å–±–æ—Ä–∫–∞ (–µ—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)\n\n### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É\n1. –ù–∞–∂–º–∏—Ç–µ **Win + R**\n2. –í–≤–µ–¥–∏—Ç–µ `cmd` –∏ –Ω–∞–∂–º–∏—Ç–µ Enter\n3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞:\n   ```cmd\n   cd C:\\MSProjectAnalyzer\n   ```\n\n### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏\n```cmd\npython -m pip install --upgrade pip\npython -m pip install -r requirements_exe.txt\n```\n\n### –®–∞–≥ 3: –°–æ–±–µ—Ä–∏—Ç–µ .exe\n```cmd\npyinstaller app.spec --clean\n```\n\n### –®–∞–≥ 4: –ù–∞–π–¥–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç\n–ì–æ—Ç–æ–≤—ã–π —Ñ–∞–π–ª –±—É–¥–µ—Ç –≤ –ø–∞–ø–∫–µ:\n```\ndist\\MSProjectAnalyzer.exe\n```\n\n---\n\n## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å .exe —Ñ–∞–π–ª\n\n### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫:\n1. **–î–≤–∞–∂–¥—ã –∫–ª–∏–∫–Ω–∏—Ç–µ** –ø–æ `MSProjectAnalyzer.exe`\n2. –û—Ç–∫—Ä–æ–µ—Ç—Å—è –æ–∫–Ω–æ –∫–æ–Ω—Å–æ–ª–∏ (—á–µ—Ä–Ω–æ–µ –æ–∫–Ω–æ) - **–ù–ï –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ –µ–≥–æ!**\n3. –ß–µ—Ä–µ–∑ 5-10 —Å–µ–∫—É–Ω–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º\n4. –ê–¥—Ä–µ—Å –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://localhost:8501`\n\n### –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –ø—Ä–æ–µ–∫—Ç–∞:\n1. –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–∞–∂–º–∏—Ç–µ **\"Browse files\"** –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª `.xml`\n2. –ù–∞–∂–º–∏—Ç–µ **\"üîÑ –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª\"**\n3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–∞–∫ –æ–±—ã—á–Ω–æ\n\n### –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:\n1. –ó–∞–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É –±—Ä–∞—É–∑–µ—Ä–∞\n2. –ó–∞–∫—Ä–æ–π—Ç–µ –æ–∫–Ω–æ –∫–æ–Ω—Å–æ–ª–∏ (—á–µ—Ä–Ω–æ–µ –æ–∫–Ω–æ)\n\n---\n\n## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º\n\n### ‚ùå –û—à–∏–±–∫–∞: \"Python –Ω–µ –Ω–∞–π–¥–µ–Ω\"\n**–†–µ—à–µ–Ω–∏–µ:**\n1. –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python —Å [python.org](https://www.python.org/downloads/)\n2. –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –æ—Ç–º–µ—Ç—å—Ç–µ **\"Add Python to PATH\"**\n3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–º–ø—å—é—Ç–µ—Ä\n4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: –æ—Ç–∫—Ä–æ–π—Ç–µ `cmd` –∏ –≤–≤–µ–¥–∏—Ç–µ `python --version`\n\n### ‚ùå –û—à–∏–±–∫–∞: \"–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏\"\n**–†–µ—à–µ–Ω–∏–µ:**\n1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç\n2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å pip:\n   ```cmd\n   python -m pip install --upgrade pip\n   ```\n3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–æ –æ–¥–Ω–æ–π:\n   ```cmd\n   python -m pip install streamlit\n   python -m pip install pandas\n   python -m pip install lxml\n   python -m pip install plotly\n   python -m pip install reportlab\n   python -m pip install pyinstaller\n   ```\n\n### ‚ùå –û—à–∏–±–∫–∞: \"PyInstaller failed\"\n**–†–µ—à–µ–Ω–∏–µ:**\n1. **–í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç–µ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å** (—á–∞—Å—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç PyInstaller)\n2. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à:\n   ```cmd\n   rd /s /q build\n   rd /s /q dist\n   rd /s /q __pycache__\n   ```\n3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞: `pyinstaller app.spec --clean`\n\n### ‚ùå .exe –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –Ω–æ –±—Ä–∞—É–∑–µ—Ä –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è\n**–†–µ—à–µ–Ω–∏–µ:**\n1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –≤—Ä—É—á–Ω—É—é\n2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8501`\n3. –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –Ω–æ–º–µ—Ä –ø–æ—Ä—Ç–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å 8502, 8503...)\n\n### ‚ùå –ê–Ω—Ç–∏–≤–∏—Ä—É—Å –±–ª–æ–∫–∏—Ä—É–µ—Ç .exe —Ñ–∞–π–ª\n**–†–µ—à–µ–Ω–∏–µ:**\n1. –î–æ–±–∞–≤—å—Ç–µ `MSProjectAnalyzer.exe` –≤ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–∞\n2. –≠—Ç–æ **–Ω–µ –≤–∏—Ä—É—Å** - —ç—Ç–æ –ª–æ–∂–Ω–æ–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —É–ø–∞–∫–æ–≤–∞–Ω–Ω—ã–π Python –∫–æ–¥\n3. –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª –Ω–∞ [VirusTotal](https://www.virustotal.com/)\n\n### ‚ùå –û—à–∏–±–∫–∞ \"Failed to execute script\"\n**–†–µ—à–µ–Ω–∏–µ:**\n1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ä—è–¥–æ–º —Å .exe –µ—Å—Ç—å –ø–∞–ø–∫–∞ `_internal` (—Å–æ–∑–¥–∞–µ—Ç—Å—è PyInstaller)\n2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ .exe –∏–∑ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –æ—à–∏–±–∫—É:\n   ```cmd\n   MSProjectAnalyzer.exe\n   ```\n3. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ —Å —Ñ–ª–∞–≥–æ–º `--debug`:\n   ```cmd\n   pyinstaller app.spec --clean --debug all\n   ```\n\n### ‚ùå –û—à–∏–±–∫–∞ \"PackageNotFoundError: No package metadata was found for streamlit\"\n**–ß—Ç–æ —ç—Ç–æ:**\n- –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–æ–≥–¥–∞ PyInstaller –Ω–µ –≤–∫–ª—é—á–∏–ª –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫ (version info)\n- Streamlit –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–µ—Ä—Å–∏—é –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ, –∏ –µ—Å–ª–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç - –ø–∞–¥–∞–µ—Ç —Å —ç—Ç–æ–π –æ—à–∏–±–∫–æ–π\n\n**–†–µ—à–µ–Ω–∏–µ:**\n–§–∞–π–ª `app.spec` —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ - —Å—Ç—Ä–æ–∫–∏ `copy_metadata()` –¥–ª—è –≤—Å–µ—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫:\n```python\n# –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç–æ–≤ (—Ä–µ—à–∞–µ—Ç –æ—à–∏–±–∫—É PackageNotFoundError)\ndatas += copy_metadata('streamlit')\ndatas += copy_metadata('pandas')\ndatas += copy_metadata('plotly')\n...\n```\n\n–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è:\n1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é `app.spec` –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞\n2. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ .exe –∑–∞–Ω–æ–≤–æ:\n   ```cmd\n   rd /s /q build dist\n   pyinstaller app.spec --clean\n   ```\n3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:\n   ```cmd\n   python -m pip list\n   ```\n\n### ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ pandas/pyarrow (cmake failed, subprocess-exited-with-error)\n**–ß—Ç–æ —ç—Ç–æ:**\n- Windows –ø—ã—Ç–∞–µ—Ç—Å—è —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤, –Ω–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞\n\n**–†–µ—à–µ–Ω–∏–µ:**\n1. **–°–Ω–∞—á–∞–ª–∞ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–æ—Ç–æ–≤—ã–µ wheel-—Ñ–∞–π–ª—ã:\n   ```cmd\n   python -m pip install --upgrade pip wheel setuptools\n   python -m pip install --only-binary :all: pyarrow pandas\n   python -m pip install streamlit lxml plotly reportlab openpyxl python-dateutil fpdf pyinstaller\n   ```\n\n2. **–ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É –≤–∞—Å **64-–±–∏—Ç–Ω—ã–π Python**:\n   ```cmd\n   python -c \"import platform; print(platform.architecture())\"\n   ```\n   –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: `('64bit', 'WindowsPE')`  \n   –ï—Å–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `32bit` - –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python 64-bit —Å [python.org](https://www.python.org/downloads/)\n\n3. **–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤–∞—Ä–∏–∞–Ω—Ç:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ [Microsoft C++ Build Tools](https://visualstudio.microsoft.com/visual-cpp-build-tools/)\n\n---\n\n## –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ .exe —Ñ–∞–π–ª–∞\n\n### –ß—Ç–æ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º:\n1. **–¢–æ–ª—å–∫–æ —Ñ–∞–π–ª `MSProjectAnalyzer.exe`** - —ç—Ç–æ –≤—Å—ë!\n2. –ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–æ–∫ Python –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è\n\n### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–æ–º–ø—å—é—Ç–µ—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n- Windows 10 –∏–ª–∏ –≤—ã—à–µ (64-bit)\n- 2 –ì–ë RAM –º–∏–Ω–∏–º—É–º\n- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä (Chrome, Firefox, Edge)\n- –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Python\n- –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫\n\n### –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞:\n- **150-300 –ú–ë** - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ\n- –§–∞–π–ª –±–æ–ª—å—à–æ–π –ø–æ—Ç–æ–º—É —á—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–µ—Å—å Python + –≤—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏\n- –≠—Ç–æ —Ü–µ–Ω–∞ –∑–∞ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç—å (–Ω–µ –Ω—É–∂–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞)\n\n---\n\n## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã\n\n### –í–∞—Ä–∏–∞–Ω—Ç 1: –õ–µ–≥–∫–∞—è —Å–±–æ—Ä–∫–∞ (—Ç—Ä–µ–±—É–µ—Ç Python —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)\n–ï—Å–ª–∏ .exe —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π, –º–æ–∂–Ω–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å –∏—Å—Ö–æ–¥–Ω–∏–∫–∏:\n1. –ü–µ—Ä–µ–¥–∞–π—Ç–µ –ø–∞–ø–∫—É —Å `.py` —Ñ–∞–π–ª–∞–º–∏\n2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `pip install -r requirements_exe.txt`\n3. –ó–∞–ø—É—Å–∫: `streamlit run app.py`\n\n### –í–∞—Ä–∏–∞–Ω—Ç 2: –í–µ–±-–≤–µ—Ä—Å–∏—è (Replit Deploy)\n–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç - –æ–ø—É–±–ª–∏–∫—É–π—Ç–µ –Ω–∞ Replit:\n1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **\"Deploy\"** –≤ Replit\n2. –ü–æ–ª—É—á–∏—Ç–µ –ø—É–±–ª–∏—á–Ω—É—é —Å—Å—ã–ª–∫—É\n3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏\n\n---\n\n## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n\n### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç PyInstaller:\n- –£–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç Python –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä\n- –£–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç –≤—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (Streamlit, Pandas, Plotly...)\n- –£–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç –≤–∞—à –∫–æ–¥ (run_app.py, app.py, md3_components.py)\n- –°–æ–∑–¥–∞–µ—Ç –æ–¥–∏–Ω .exe —Ñ–∞–π–ª —Å –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–º –∑–∞–ø—É—Å–∫–æ–º\n- run_app.py - —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π launcher, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç Streamlit –ø—Ä–∞–≤–∏–ª—å–Ω–æ\n\n### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ app.spec:\n- `Analysis(['run_app.py'])` - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ launcher\n- `hiddenimports` - —Å–∫—Ä—ã—Ç—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Streamlit\n- `datas` - —Ñ–∞–π–ª—ã –¥–∞–Ω–Ω—ã—Ö (app.py, md3_components.py, config.toml)\n- `console=True` - –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–∫–æ–Ω–∫—É: `icon='app.ico'`\n\n### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω run_app.py:\n- Streamlit —Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—Å–∫–∞ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `streamlit run`\n- PyInstaller –Ω–µ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å —ç—Ç—É –∫–æ–º–∞–Ω–¥—É –Ω–∞–ø—Ä—è–º—É—é\n- run_app.py - —ç—Ç–æ launcher, –∫–æ—Ç–æ—Ä—ã–π —ç–º—É–ª–∏—Ä—É–µ—Ç `streamlit run app.py`\n- –ë–µ–∑ –Ω–µ–≥–æ .exe –±—É–¥–µ—Ç –ø–∞–¥–∞—Ç—å —Å –æ—à–∏–±–∫–æ–π \"must be run with streamlit run\"\n\n### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞:\n–î–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ .exe:\n1. –ò—Å–∫–ª—é—á–∏—Ç–µ –Ω–µ–Ω—É–∂–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤ `excludes`\n2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `upx=True` –¥–ª—è —Å–∂–∞—Ç–∏—è (—É–∂–µ –≤–∫–ª—é—á–µ–Ω–æ)\n3. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–≤—É—Ö—Ñ–∞–π–ª–æ–≤—É—é —Å–±–æ—Ä–∫—É –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ—Ñ–∞–π–ª–æ–≤–æ–π\n\n---\n\n## –ü–æ–¥–¥–µ—Ä–∂–∫–∞\n\n–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:\n1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã—à–µ\n2. –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö\n3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –æ–∫–Ω–µ –∫–æ–Ω—Å–æ–ª–∏\n4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä—É—á–Ω—É—é —Å–±–æ—Ä–∫—É –≤–º–µ—Å—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π\n\n**–£–¥–∞—á–Ω–æ–π —Å–±–æ—Ä–∫–∏!** üöÄ\n","size_bytes":11917},"run_app.py":{"content":"\"\"\"\nLauncher script –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Streamlit –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ PyInstaller\n–≠—Ç–æ—Ç —Ñ–∞–π–ª —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É \"must be run with streamlit run\"\n\"\"\"\nimport sys\nimport os\nfrom streamlit.web import cli as stcli\n\nif __name__ == '__main__':\n    # –ü–æ–ª—É—á–∏—Ç—å –ø—É—Ç—å –∫ app.py (–≤ —Ç–æ–π –∂–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏)\n    if getattr(sys, 'frozen', False):\n        # –ï—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω–æ —á–µ—Ä–µ–∑ PyInstaller\n        application_path = sys._MEIPASS\n    else:\n        # –ï—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω–æ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ Python\n        application_path = os.path.dirname(os.path.abspath(__file__))\n\n    app_path = os.path.join(application_path, 'app.py')\n\n    # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ã –¥–ª—è Streamlit CLI\n    sys.argv = [\n        \"streamlit\", \"run\", app_path, \"--server.headless=true\",\n        \"--browser.gatherUsageStats=false\"\n    ]\n\n    # –ó–∞–ø—É—Å—Ç–∏—Ç—å Streamlit\n    sys.exit(stcli.main())\n","size_bytes":953},"md3_components.py":{"content":"\"\"\"\nMaterial Design 3 Theme Components\n–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ Material Design 3 —Å –ø–∞–ª–∏—Ç—Ä–æ–π –∏–∑ #0078D4\n\"\"\"\n\nimport streamlit as st\n\n# MD3 —Ü–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–∑ seed color #0078D4\nMD3_COLORS = {\n    # Light theme colors\n    'primary': '#005EB0',\n    'on_primary': '#FFFFFF',\n    'primary_container': '#D1E4FF',\n    'on_primary_container': '#001B3D',\n    \n    'secondary': '#545F71',\n    'on_secondary': '#FFFFFF',\n    'secondary_container': '#D8E3F8',\n    'on_secondary_container': '#111C2B',\n    \n    'tertiary': '#6D5677',\n    'on_tertiary': '#FFFFFF',\n    'tertiary_container': '#F5D9FF',\n    'on_tertiary_container': '#271431',\n    \n    'error': '#BA1A1A',\n    'on_error': '#FFFFFF',\n    'error_container': '#FFDAD6',\n    'on_error_container': '#410002',\n    \n    'background': '#FDFBFF',\n    'on_background': '#1A1C1E',\n    'surface': '#FDFBFF',\n    'on_surface': '#1A1C1E',\n    'surface_variant': '#DFE2EB',\n    'on_surface_variant': '#43474E',\n    \n    'outline': '#73777F',\n    'outline_variant': '#C3C6CF',\n}\n\ndef get_md3_css():\n    \"\"\"–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç CSS —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–º—ã Material Design 3\"\"\"\n    return f\"\"\"\n    <style>\n        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');\n        \n        /* MD3 Color Variables */\n        :root {{\n            --md-sys-color-primary: {MD3_COLORS['primary']};\n            --md-sys-color-on-primary: {MD3_COLORS['on_primary']};\n            --md-sys-color-primary-container: {MD3_COLORS['primary_container']};\n            --md-sys-color-on-primary-container: {MD3_COLORS['on_primary_container']};\n            \n            --md-sys-color-secondary: {MD3_COLORS['secondary']};\n            --md-sys-color-on-secondary: {MD3_COLORS['on_secondary']};\n            --md-sys-color-secondary-container: {MD3_COLORS['secondary_container']};\n            --md-sys-color-on-secondary-container: {MD3_COLORS['on_secondary_container']};\n            \n            --md-sys-color-tertiary: {MD3_COLORS['tertiary']};\n            --md-sys-color-on-tertiary: {MD3_COLORS['on_tertiary']};\n            --md-sys-color-tertiary-container: {MD3_COLORS['tertiary_container']};\n            --md-sys-color-on-tertiary-container: {MD3_COLORS['on_tertiary_container']};\n            \n            --md-sys-color-error: {MD3_COLORS['error']};\n            --md-sys-color-on-error: {MD3_COLORS['on_error']};\n            --md-sys-color-error-container: {MD3_COLORS['error_container']};\n            --md-sys-color-on-error-container: {MD3_COLORS['on_error_container']};\n            \n            --md-sys-color-background: {MD3_COLORS['background']};\n            --md-sys-color-on-background: {MD3_COLORS['on_background']};\n            --md-sys-color-surface: {MD3_COLORS['surface']};\n            --md-sys-color-on-surface: {MD3_COLORS['on_surface']};\n            --md-sys-color-surface-variant: {MD3_COLORS['surface_variant']};\n            --md-sys-color-on-surface-variant: {MD3_COLORS['on_surface_variant']};\n            \n            --md-sys-color-outline: {MD3_COLORS['outline']};\n            --md-sys-color-outline-variant: {MD3_COLORS['outline_variant']};\n        }}\n        \n        /* MD3 Typography Scale */\n        .md3-display-large {{\n            font-family: 'Roboto', sans-serif;\n            font-size: 57px;\n            font-weight: 400;\n            line-height: 64px;\n            letter-spacing: -0.25px;\n        }}\n        \n        .md3-display-medium {{\n            font-family: 'Roboto', sans-serif;\n            font-size: 45px;\n            font-weight: 400;\n            line-height: 52px;\n            letter-spacing: 0;\n        }}\n        \n        .md3-display-small {{\n            font-family: 'Roboto', sans-serif;\n            font-size: 36px;\n            font-weight: 400;\n            line-height: 44px;\n            letter-spacing: 0;\n        }}\n        \n        .md3-headline-large {{\n            font-family: 'Roboto', sans-serif;\n            font-size: 32px;\n            font-weight: 400;\n            line-height: 40px;\n            letter-spacing: 0;\n        }}\n        \n        .md3-headline-medium {{\n            font-family: 'Roboto', sans-serif;\n            font-size: 28px;\n            font-weight: 400;\n            line-height: 36px;\n            letter-spacing: 0;\n        }}\n        \n        .md3-headline-small {{\n            font-family: 'Roboto', sans-serif;\n            font-size: 24px;\n            font-weight: 400;\n            line-height: 32px;\n            letter-spacing: 0;\n        }}\n        \n        .md3-title-large {{\n            font-family: 'Roboto', sans-serif;\n            font-size: 22px;\n            font-weight: 400;\n            line-height: 28px;\n            letter-spacing: 0;\n        }}\n        \n        .md3-title-medium {{\n            font-family: 'Roboto', sans-serif;\n            font-size: 16px;\n            font-weight: 500;\n            line-height: 24px;\n            letter-spacing: 0.15px;\n        }}\n        \n        .md3-title-small {{\n            font-family: 'Roboto', sans-serif;\n            font-size: 14px;\n            font-weight: 500;\n            line-height: 20px;\n            letter-spacing: 0.1px;\n        }}\n        \n        .md3-body-large {{\n            font-family: 'Roboto', sans-serif;\n            font-size: 16px;\n            font-weight: 400;\n            line-height: 24px;\n            letter-spacing: 0.5px;\n        }}\n        \n        .md3-body-medium {{\n            font-family: 'Roboto', sans-serif;\n            font-size: 14px;\n            font-weight: 400;\n            line-height: 20px;\n            letter-spacing: 0.25px;\n        }}\n        \n        .md3-body-small {{\n            font-family: 'Roboto', sans-serif;\n            font-size: 12px;\n            font-weight: 400;\n            line-height: 16px;\n            letter-spacing: 0.4px;\n        }}\n        \n        .md3-label-large {{\n            font-family: 'Roboto', sans-serif;\n            font-size: 14px;\n            font-weight: 500;\n            line-height: 20px;\n            letter-spacing: 0.1px;\n        }}\n        \n        .md3-label-medium {{\n            font-family: 'Roboto', sans-serif;\n            font-size: 12px;\n            font-weight: 500;\n            line-height: 16px;\n            letter-spacing: 0.5px;\n        }}\n        \n        .md3-label-small {{\n            font-family: 'Roboto', sans-serif;\n            font-size: 11px;\n            font-weight: 500;\n            line-height: 16px;\n            letter-spacing: 0.5px;\n        }}\n        \n        /* MD3 App Styling */\n        .stApp {{\n            background-color: var(--md-sys-color-background);\n            font-family: 'Roboto', sans-serif;\n        }}\n        \n        /* MD3 Headers */\n        h1 {{\n            color: var(--md-sys-color-on-background);\n            font-family: 'Roboto', sans-serif;\n            font-size: 28px;\n            font-weight: 400;\n            line-height: 36px;\n        }}\n        \n        h2 {{\n            color: var(--md-sys-color-on-background);\n            font-family: 'Roboto', sans-serif;\n            font-size: 24px;\n            font-weight: 400;\n            line-height: 32px;\n        }}\n        \n        h3 {{\n            color: var(--md-sys-color-on-background);\n            font-family: 'Roboto', sans-serif;\n            font-size: 22px;\n            font-weight: 400;\n            line-height: 28px;\n        }}\n        \n        /* MD3 Elevated Card */\n        .md3-card {{\n            background-color: var(--md-sys-color-surface);\n            border-radius: 12px;\n            padding: 24px;\n            margin: 16px 0;\n            box-shadow: 0px 1px 2px rgba(0, 0, 0, 0.3), \n                        0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n            transition: box-shadow 0.3s ease;\n        }}\n        \n        .md3-card:hover {{\n            box-shadow: 0px 2px 6px 2px rgba(0, 0, 0, 0.15), \n                        0px 1px 2px 0px rgba(0, 0, 0, 0.30);\n        }}\n        \n        /* MD3 Buttons */\n        .md3-filled-button {{\n            background-color: var(--md-sys-color-primary);\n            color: var(--md-sys-color-on-primary);\n            border: none;\n            border-radius: 20px;\n            padding: 10px 24px;\n            font-family: 'Roboto', sans-serif;\n            font-size: 14px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: all 0.2s ease;\n            box-shadow: 0px 1px 2px rgba(0, 0, 0, 0.3), \n                        0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n        }}\n        \n        .md3-filled-button:hover {{\n            box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15), \n                        0px 1px 2px 0px rgba(0, 0, 0, 0.30);\n            background-color: #004a8f;\n        }}\n        \n        .md3-outlined-button {{\n            background-color: transparent;\n            color: var(--md-sys-color-primary);\n            border: 1px solid var(--md-sys-color-outline);\n            border-radius: 20px;\n            padding: 10px 24px;\n            font-family: 'Roboto', sans-serif;\n            font-size: 14px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: all 0.2s ease;\n        }}\n        \n        .md3-outlined-button:hover {{\n            background-color: rgba(0, 94, 176, 0.08);\n        }}\n        \n        .md3-text-button {{\n            background-color: transparent;\n            color: var(--md-sys-color-primary);\n            border: none;\n            border-radius: 20px;\n            padding: 10px 12px;\n            font-family: 'Roboto', sans-serif;\n            font-size: 14px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: all 0.2s ease;\n        }}\n        \n        .md3-text-button:hover {{\n            background-color: rgba(0, 94, 176, 0.08);\n        }}\n        \n        /* MD3 Dataframe Styling */\n        .dataframe {{\n            font-family: 'Roboto', sans-serif;\n            font-size: 14px;\n            border-radius: 12px;\n            overflow: hidden;\n        }}\n        \n        .dataframe thead tr th {{\n            background-color: var(--md-sys-color-surface-variant);\n            color: var(--md-sys-color-on-surface-variant);\n            font-weight: 500;\n            padding: 12px 16px;\n        }}\n        \n        .dataframe tbody tr:nth-child(even) {{\n            background-color: var(--md-sys-color-surface-variant);\n        }}\n        \n        .dataframe tbody tr:hover {{\n            background-color: rgba(0, 94, 176, 0.08);\n        }}\n        \n        .dataframe tbody tr td {{\n            padding: 12px 16px;\n        }}\n    </style>\n    \"\"\"\n\n\ndef md3_metric_card(icon, value, label, description=\"\"):\n    \"\"\"\n    –°–æ–∑–¥–∞–µ—Ç MD3 –º–µ—Ç—Ä–∏–∫—É –≤ —Å—Ç–∏–ª–µ Elevated Card\n    \n    Args:\n        icon: –≠–º–æ–¥–∑–∏ –∏–∫–æ–Ω–∫–∞\n        value: –ó–Ω–∞—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏\n        label: –ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏\n        description: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)\n    \"\"\"\n    desc_html = f'<div class=\"md3-body-small\" style=\"color: var(--md-sys-color-on-surface-variant); margin-top: 4px;\">{description}</div>' if description else ''\n    \n    return f\"\"\"\n    <div class=\"md3-card\" style=\"text-align: center;\">\n        <div style=\"font-size: 32px; margin-bottom: 8px;\">{icon}</div>\n        <div class=\"md3-display-small\" style=\"color: var(--md-sys-color-on-surface); margin-bottom: 4px;\">{value}</div>\n        <div class=\"md3-label-medium\" style=\"color: var(--md-sys-color-on-surface-variant);\">{label}</div>\n        {desc_html}\n    </div>\n    \"\"\"\n\n\ndef md3_info_panel(period_text, business_days, capacity_hours):\n    \"\"\"\n    –°–æ–∑–¥–∞–µ—Ç –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–∏–æ–¥–æ–º –≤ MD3 —Å—Ç–∏–ª–µ\n    \n    Args:\n        period_text: –¢–µ–∫—Å—Ç –ø–µ—Ä–∏–æ–¥–∞ –∞–Ω–∞–ª–∏–∑–∞\n        business_days: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π\n        capacity_hours: –†–∞–±–æ—á–∞—è —ë–º–∫–æ—Å—Ç—å –≤ —á–∞—Å–∞—Ö\n    \"\"\"\n    return f\"\"\"\n    <div style=\"margin: 24px 0;\">\n        <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;\">\n            {md3_metric_card(\"üìÖ\", period_text, \"–ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞\")}\n            {md3_metric_card(\"üìä\", f\"{business_days} –¥–Ω.\", \"–†–∞–±–æ—á–∏–µ –¥–Ω–∏\", \"–ü–Ω-–ü—Ç\")}\n            {md3_metric_card(\"‚è±Ô∏è\", f\"{capacity_hours} —á\", \"–Å–º–∫–æ—Å—Ç—å –Ω–∞ —á–µ–ª.\", f\"{business_days} √ó 8 —á–∞—Å–æ–≤\")}\n        </div>\n    </div>\n    \"\"\"\n\n\ndef md3_chip(text, closeable=False, chip_id=\"\"):\n    \"\"\"\n    –°–æ–∑–¥–∞–µ—Ç MD3 Chip –∫–æ–º–ø–æ–Ω–µ–Ω—Ç\n    \n    Args:\n        text: –¢–µ–∫—Å—Ç —á–∏–ø–∞\n        closeable: –ú–æ–∂–µ—Ç –ª–∏ —á–∏–ø –±—ã—Ç—å —É–¥–∞–ª–µ–Ω\n        chip_id: ID —á–∏–ø–∞ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏\n    \"\"\"\n    close_btn = f'<button class=\"md3-chip-close\" onclick=\"removeChip(\\'{chip_id}\\')\">√ó</button>' if closeable else ''\n    \n    return f\"\"\"\n    <div class=\"md3-chip\" id=\"{chip_id}\">\n        <span class=\"md3-label-large\">{text}</span>\n        {close_btn}\n    </div>\n    \"\"\"\n\n\ndef get_md3_table_style():\n    \"\"\"–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç CSS –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü –≤ MD3\"\"\"\n    return \"\"\"\n    <style>\n        /* MD3 Table Container */\n        .stDataFrame {{\n            border-radius: 12px;\n            overflow: hidden;\n        }}\n        \n        /* Status colors - MD3 style */\n        .status-overloaded {{\n            background-color: var(--md-sys-color-error-container);\n            color: var(--md-sys-color-on-error-container);\n            padding: 6px 12px;\n            border-radius: 8px;\n            font-weight: 500;\n            font-size: 12px;\n            display: inline-block;\n        }}\n        \n        .status-optimal {{\n            background-color: var(--md-sys-color-primary-container);\n            color: var(--md-sys-color-on-primary-container);\n            padding: 6px 12px;\n            border-radius: 8px;\n            font-weight: 500;\n            font-size: 12px;\n            display: inline-block;\n        }}\n        \n        .status-underutilized {{\n            background-color: var(--md-sys-color-tertiary-container);\n            color: var(--md-sys-color-on-tertiary-container);\n            padding: 6px 12px;\n            border-radius: 8px;\n            font-weight: 500;\n            font-size: 12px;\n            display: inline-block;\n        }}\n    </style>\n    \"\"\"\n\n\ndef get_md3_chart_colors():\n    \"\"\"–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç MD3 —Ü–≤–µ—Ç–∞ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ Plotly\"\"\"\n    return {\n        'overloaded': MD3_COLORS['error'],\n        'optimal': MD3_COLORS['primary'],\n        'underutilized': MD3_COLORS['tertiary'],\n        'background': MD3_COLORS['surface'],\n        'text': MD3_COLORS['on_surface'],\n    }\n","size_bytes":14779}},"version":2}