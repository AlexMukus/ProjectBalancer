# Анализатор управления ресурсами

## Обзор

Это настольное приложение, построенное на Streamlit для анализа файлов планов Microsoft Project. Приложение парсит XML-файлы MS Project для выявления дисбаланса рабочей нагрузки между ресурсами, визуализирует шаблоны распределения с цветными индикаторами статуса и предоставляет практические рекомендации по оптимизации. Пользователи могут фильтровать ресурсы, просматривать детальную разбивку задач и экспортировать результаты анализа в формате CSV или PDF.

## Предпочтения пользователя

Предпочитаемый стиль коммуникации: Простой, повседневный язык на русском.

## Системная архитектура

### Архитектура фронтенда

**Выбор технологии: Streamlit**
- **Проблема**: Необходимость быстрого прототипирования интерфейса с фокусом на данные без сложной разработки фронтенда
- **Решение**: Streamlit предоставляет Python-нативный подход к созданию интерактивных веб-приложений
- **Обоснование**: Позволяет быструю разработку дашбордов визуализации данных с минимальными знаниями JavaScript/HTML
- **Компромиссы**: 
  - Плюсы: Быстрая разработка, встроенные виджеты, отлично для приложений с данными
  - Минусы: Ограниченная кастомизация по сравнению с React/Vue, только рендеринг на стороне сервера

**Стратегия визуализации: Plotly**
- **Проблема**: Необходимость интерактивных, профессиональных графиков для анализа рабочей нагрузки
- **Решение**: Объекты графиков Plotly для создания динамических визуализаций
- **Обоснование**: Обеспечивает богатую интерактивность (наведение, масштабирование, панорамирование), необходимую для исследования данных ресурсов
- **Рассмотренные альтернативы**: Matplotlib (только статика), Altair (менее интерактивна)

**Подход к стилизации: Пользовательский CSS с системой дизайна Microsoft**
- **Проблема**: Стандартный внешний вид Streamlit не передаёт профессионального корпоративного ощущения
- **Решение**: Инъекция пользовательского CSS с использованием цветовой палитры Microsoft Fluent UI
- **Принципы дизайна**: 
  - Система цветовой кодировки (Красный/Жёлтый/Зелёный) для быстрой визуальной оценки
  - Цветовая схема в стиле Microsoft (#0078D4 основной синий и т.д.)
  - Карточная компоновка для отображения метрик

### Архитектура бэкенда

**Обработка файлов: Парсинг XML с помощью lxml**
- **Проблема**: Необходимость парсинга формата XML Microsoft Project (файлы .xml, .mspdi)
- **Решение**: lxml.etree для надёжного парсинга XML
- **Обоснование**: lxml - отраслевой стандарт для обработки XML на Python, эффективно обрабатывает большие файлы
- **Поток обработки**: Загрузка файла → Парсинг XML → Извлечение данных → Преобразование DataFrame

**Обработка данных: Pandas**
- **Проблема**: Сложные расчёты распределения ресурсов во времени
- **Решение**: DataFrame Pandas для табличной обработки данных
- **Ключевые операции**:
  - Агрегация ресурсов по имени/фамилии
  - Расчёт процента рабочей нагрузки на основе мощности
  - Анализ распределения на основе временной шкалы
  - Возможности фильтрации и поиска

**Логика расчёта рабочей нагрузки**
- **Пороги мощности**:
  - Перегружен: >100% мощности (Красный индикатор)
  - Оптимально: 70-100% мощности (Зелёный индикатор)
  - Недоиспользуется: <70% мощности (Жёлтый индикатор)
- **Алгоритм**: Анализирует фактические сроки проекта относительно мощности ресурса для вычисления процентов использования

**Движок рекомендаций**
- **Уровни приоритета**:
  - Высокий приоритет: Ресурсы >120% мощности
  - Средний приоритет: Ресурсы 100-120% мощности
  - Низкий приоритет: Оптимизация недоиспользуемых ресурсов
- **Вывод**: Практические предложения по перебалансировке рабочей нагрузки

### Генерация отчётов

**Экспорт PDF: ReportLab**
- **Проблема**: Необходимость профессиональных PDF-отчётов для распространения заинтересованным сторонам
- **Решение**: Библиотека ReportLab с пользовательской стилизацией таблиц
- **Функции**:
  - Поддержка размеров страниц Letter/A4
  - Стилизованные таблицы с заголовками
  - Форматирование абзацев для рекомендаций
  - Пользовательская цветовая схема, соответствующая интерфейсу

**Экспорт CSV: Нативный Pandas**
- **Проблема**: Пользователям нужны необработанные данные для дальнейшего анализа в Excel
- **Решение**: Метод Pandas to_csv() с кодировкой UTF-8
- **Обоснование**: Простой, универсальный формат для обмена данными

### Управление состоянием

**Стратегия состояния сессии**
- **Проблема**: Streamlit перезапускает весь скрипт при взаимодействии, теряя данные
- **Решение**: st.session_state для сохранения распарсенных данных и выбора пользователя
- **Хранимые данные**:
  - Распарсенные данные проекта
  - Выбранные ресурсы
  - Фильтры поиска
  - Результаты анализа

## Внешние зависимости

### Основные библиотеки

**Streamlit** (Веб-фреймворк)
- Назначение: Фреймворк интерактивных веб-приложений
- Случай использования: Рендеринг UI, виджеты, управление компоновкой
- Ограничения версии: Рекомендуется последняя стабильная версия

**Pandas** (Обработка данных)
- Назначение: Манипуляция и анализ табличных данных
- Случай использования: Агрегация данных ресурсов, расчёты, фильтрация
- Критично для алгоритмов анализа рабочей нагрузки

**lxml** (Парсинг XML)
- Назначение: Высокопроизводительный парсер XML/HTML
- Случай использования: Парсинг XML-файлов Microsoft Project
- Альтернатива встроенному xml.etree для лучшей производительности

**Plotly** (Визуализация)
- Назначение: Библиотека интерактивного построения графиков
- Случай использования: Графики распределения ресурсов, визуализация временных шкал
- Предоставляет интерактивные графики на основе JavaScript

**ReportLab** (Генерация PDF)
- Назначение: Создание PDF-документов
- Случай использования: Генерация профессиональных отчётов анализа
- Зависимости: модули reportlab.lib, reportlab.platypus

### Поддержка форматов файлов

**Формат XML Microsoft Project**
- Входной формат: файлы .xml, .mspdi
- Требуется конвертация: файлы .mpp должны быть сохранены как XML из MS Project
- Схема: Схема XML Microsoft Project для данных задач и ресурсов

### Будущие соображения по интеграции

**Потенциальная интеграция с базой данных**
- Текущее состояние: Файловое хранилище только для сессии
- Будущий вариант: Постоянное хранилище для исторического анализа
- Технологии-кандидаты: SQLite для локального хранения, PostgreSQL для многопользовательских сценариев

**Аутентификация (в настоящее время не реализована)**
- Текущее состояние: Приложение с открытым доступом
- Корпоративное соображение: Может потребоваться интеграция с Active Directory или провайдерами OAuth
